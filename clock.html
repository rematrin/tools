<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Мировые часы</title>
  <link rel="icon" type="image/png" href="clock.png">
  <link rel="apple-touch-icon" href="clock2.png">

  <link rel="stylesheet" href="theme.css">

  <style>
    /* === ЛОКАЛЬНЫЕ ПЕРЕОПРЕДЕЛЕНИЯ ЦВЕТОВ === */
    /* Возвращаем "синеватые" цвета вместо глобальных фиолетовых */
    :root {
      --accent: #7aa2ff;
      /* Тот самый синий цвет */
      --accent-hover: #6690ea;
      /* Чуть темнее для наведения */

      --input-bg: #ffffff;
      /* Белый фон для инпута (как было) */
      --btn-hover: #f0f2f7;

      --gray: #999;
      --danger: #ff5757;
    }

    body.dark {
      --accent: #5b8af0;
      /* Синий для темной темы */
      --accent-hover: #4a78d0;

      --input-bg: #1a1d22;
      /* Темный фон инпута */
      --btn-hover: #252830;
      --gray: #6b6b6b;
    }

    /* Исправление иконок в темной теме */
    body.dark .theme-icon,
    body.dark #shareBtn img,
    body.dark #copyLink img {
      filter: invert(1) brightness(1.3);
    }

    /* Специфичные настройки для шаринга */
    body.dark #sharePopup {
      background: var(--card-bg);
      border-color: var(--border);
      color: var(--text);
    }

    body.dark .share-input-group {
      background: #0f1115;
      border-color: var(--border);
    }

    .wrap {
      max-width: 500px;
      margin: 0 auto;
      padding: 22px 14px 28px;
    }

    /* ШАПКА */
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    h1 {
      font-size: 1.25rem;
      margin: 0;
      color: var(--text);
    }

    .topbar-controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    /* КНОПКИ В ШАПКЕ */
    button.header-btn {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4px 10px;
      font-size: 0.9rem;
      gap: 6px;
    }

    button.header-btn:hover {
      background: var(--btn-hover);
    }

    #shareBtn img {
      width: 11px;
      height: 11px;
      display: block;
    }

    /* КАРТОЧКИ ГОРОДОВ */
    .card {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .03);
      padding: 10px 12px;
      transition: background 0.3s, border-color 0.3s;
      position: relative;
    }

    .code {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      color: var(--text);
    }

    .flag {
      border-radius: 4px;
      width: 24px;
      height: 18px;
      vertical-align: middle;
    }

    .time {
      font-size: 1.3rem;
      font-variant-numeric: tabular-nums;
      display: flex;
      align-items: flex-end;
      gap: 4px;
      text-align: right;
      transition: padding-right 0.2s ease;
      color: var(--text);
    }

    .seconds {
      font-size: .8rem;
      color: var(--gray);
      position: relative;
      bottom: 2px;
      opacity: 0.7;
    }

    .edit-mode .time {
      padding-right: 28px;
    }

    /* КРЕСТИК УДАЛЕНИЯ */
    .delBtn {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 1.1rem;
      color: var(--gray);
      cursor: pointer;
      opacity: 0.7;
      display: none;
      z-index: 5;
      transition: color 0.2s, opacity 0.2s;
    }

    .delBtn:hover {
      opacity: 1;
      color: var(--text);
    }

    body.edit-mode .delBtn {
      display: block;
    }

    /* НИЖНИЕ КНОПКИ (Вернул стили из старого кода) */
    .center-controls {
      display: flex;
      justify-content: center;
      width: 100%;
      margin-top: 18px;
    }

    .action-btn {
      padding: 10px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--accent);
      /* Теперь это синий */
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
    }

    .action-btn:hover {
      border-color: var(--accent);
      background: var(--btn-hover);
    }

    .action-btn svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    #editBtn {
      width: 50%;
      min-width: 200px;
    }

    /* ГРУППА РЕДАКТИРОВАНИЯ (Вернул стили инпута) */
    .edit-group {
      display: flex;
      gap: 10px;
      width: 100%;
      align-items: stretch;
    }

    .input-wrapper {
      flex-grow: 1;
      position: relative;
    }

    input[type="text"] {
      width: 100%;
      height: 100%;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--input-bg);
      /* Вернул локальную переменную */
      font-size: 16px;
      color: var(--text);
      transition: border-color 0.2s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
    }

    #saveBtn {
      width: auto;
      padding-left: 15px;
      padding-right: 15px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* ПОДСКАЗКИ ПОИСКА */
    .suggest {
      position: absolute;
      left: 0;
      bottom: calc(100% + 6px);
      width: 100%;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 -6px 18px rgba(0, 0, 0, 0.12);
      overflow: hidden;
      z-index: 10;
      display: none;
      max-height: 300px;
      overflow-y: auto;
    }

    .suggest.visible {
      display: block;
    }

    .opt {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      color: var(--text);
    }

    .opt:last-child {
      border-bottom: 0;
    }

    .opt:hover {
      background: var(--btn-hover);
    }

    .opt .country {
      font-size: .85rem;
      opacity: .7;
    }

    /* SHARE POPUP */
    /* SHARE POPUP NEW DESIGN */
    #sharePopup {
      position: absolute;
      display: none;
      background: var(--card-bg);
      border: 1px solid var(--border);
      padding: 12px;
      border-radius: 14px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      width: 340px;
      animation: fadeIn 0.25s cubic-bezier(0.16, 1, 0.3, 1);
      color: var(--text);
      flex-direction: column;
    }

    .share-input-group {
      display: flex;
      align-items: center;
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 6px;
      gap: 4px;
      transition: border-color 0.2s;
    }

    body.dark .share-input-group {
      background: #1a1d22;
    }

    .share-link-icon {
      display: flex;
      align-items: center;
      padding: 0 8px;
      color: var(--text);
      opacity: 0.5;
    }

    #shareUrlInput {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 0.95rem;
      color: var(--text);
      padding: 6px 2px;
      outline: none;
      width: 100%;
      font-family: inherit;
    }

    #copyLinkBtn {
      background: #8b5cf6;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    #copyLinkBtn:hover {
      background: #7c3aed;
      transform: translateY(-1px);
    }

    #copyLinkBtn.copied {
      background: #10b981;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-4px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* TOOLTIP (Глобальные стили в theme.css, но id нужен) */
    #customTooltip {
      position: fixed;
      background: var(--tooltip-bg);
      color: var(--tooltip-text);
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.8rem;
      pointer-events: none;
      opacity: 0;
      transform: translateY(5px);
      transition: opacity 0.2s, transform 0.2s;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      white-space: nowrap;
      font-weight: 500;
    }

    #customTooltip.visible {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-384FKZ1NQP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-384FKZ1NQP');
  </script>
</head>

<body>

  <script src="theme-loader.js"></script>

  <div id="customTooltip"></div>

  <div id="header-container"></div>

  <div class="wrap">
    <div class="topbar">
      <h1>Мировые часы</h1>
      <div class="topbar-controls">
        <button id="shareBtn" class="header-btn" data-tip="Поделиться списком">
          <img src="https://cdn-icons-png.flaticon.com/512/1828/1828954.png" alt="">
          Поделиться
        </button>
      </div>
    </div>

    <div class="card" id="clocks"></div>

    <div class="center-controls" id="mainControls">
      <button id="editBtn" class="action-btn">
        <svg viewBox="0 0 24 24">
          <path
            d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
        </svg>
        Редактировать
      </button>
    </div>

    <div class="center-controls" id="editControls" style="display:none;">
      <div class="edit-group">
        <div class="input-wrapper">
          <input id="search" type="text" placeholder="Добавить город или страну..." autocomplete="off" autocorrect="off"
            spellcheck="false">
          <div id="suggest" class="suggest" role="listbox"></div>
        </div>
        <button id="saveBtn" class="action-btn">
          <svg viewBox="0 0 24 24">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
          </svg>
          Сохранить
        </button>
      </div>
    </div>

    <div id="sharePopup">
      <div class="share-input-group">
        <div class="share-link-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
          </svg>
        </div>
        <input type="text" id="shareUrlInput" readonly value="">
        <button id="copyLinkBtn">Copy</button>
      </div>
    </div>
  </div>

  <script>
    const toId = tz => 't-' + tz.replace(/\//g, '-');
    const flagURL = c => c === 'xx' ? `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='18'><rect width='24' height='18' rx='3' ry='3' fill='#e9edf5'/></svg>` : `https://flagcdn.com/w40/${c}.png`;

    const params = new URLSearchParams(location.search);
    let cities = params.get('tz')
      ? params.get('tz').split(',').map(s => {
        const [name, tz, flag] = decodeURIComponent(s).split('|');
        return { name, tz, flag: flag || 'xx' };
      })
      : [
        { name: 'Прага', tz: 'Europe/Prague', flag: 'cz' },
        { name: 'Киев', tz: 'Europe/Kiev', flag: 'ua' },
        { name: 'Москва', tz: 'Europe/Moscow', flag: 'ru' },
        { name: 'Лондон', tz: 'Europe/London', flag: 'gb' },
        { name: 'Нью-Йорк', tz: 'America/New_York', flag: 'us' },
        { name: 'Лос-Анджелес', tz: 'America/Los_Angeles', flag: 'us' },
        { name: 'Токио', tz: 'Asia/Tokyo', flag: 'jp' },
        { name: 'Сидней', tz: 'Australia/Sydney', flag: 'au' }
      ];

    const box = document.getElementById('clocks');
    const input = document.getElementById('search');
    const sugg = document.getElementById('suggest');
    const mainControls = document.getElementById('mainControls');
    const editControls = document.getElementById('editControls');

    function render() {
      box.innerHTML = '';
      const now = new Date();

      for (const { name, tz, flag } of cities) {
        const id = toId(tz);
        const row = document.createElement('div');
        row.className = 'row';

        row.innerHTML = `
        <div class="code">
          <img class="flag" src="${flagURL(flag)}" alt="${name}">
          <span>${name}</span>
        </div>
        <div class="time" id="${id}"></div>
        <button class="delBtn" data-tip="Удалить">✕</button>
      `;

        const delBtn = row.querySelector('.delBtn');
        delBtn.onclick = () => {
          cities = cities.filter(c => c.tz !== tz);
          render();
          updateURL();
        };

        box.appendChild(row);
        setTime(id, tz, now);
      }
    }

    function setTime(id, tz, now = new Date()) {
      const el = document.getElementById(id);
      try {
        const p = new Intl.DateTimeFormat('ru-RU', { timeZone: tz, hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }).formatToParts(now);
        el.innerHTML = `${p.find(x => x.type === 'hour').value}:${p.find(x => x.type === 'minute').value} <span class='seconds'>${p.find(x => x.type === 'second').value}</span>`;
      } catch { if (el) el.innerHTML = '--:-- <span class="seconds">--</span>'; }
    }

    function tick() {
      const now = new Date();
      for (const c of cities) setTime(toId(c.tz), c.tz, now);
    }

    function buildQS() {
      const parts = cities.map(c => encodeURIComponent(`${c.name}|${c.tz}|${c.flag}`));
      return `?tz=${parts.join(',')}`;
    }

    function updateURL() { history.replaceState(null, '', location.pathname + buildQS()); }

    document.getElementById('editBtn').onclick = () => {
      mainControls.style.display = 'none';
      editControls.style.display = 'block';
      document.body.classList.add('edit-mode');
    };

    document.getElementById('saveBtn').onclick = () => {
      editControls.style.display = 'none';
      mainControls.style.display = 'flex';
      document.body.classList.remove('edit-mode');
      updateURL();
    };

    const CITIES_DB = [
      // --- Европа ---
      { name: 'Прага', country: 'Чехия', tz: 'Europe/Prague', flag: 'cz' },
      { name: 'Варшава', country: 'Польша', tz: 'Europe/Warsaw', flag: 'pl' },
      { name: 'Берлин', country: 'Германия', tz: 'Europe/Berlin', flag: 'de' },
      { name: 'Гамбург', country: 'Германия', tz: 'Europe/Berlin', flag: 'de' },
      { name: 'Мюнхен', country: 'Германия', tz: 'Europe/Berlin', flag: 'de' },
      { name: 'Париж', country: 'Франция', tz: 'Europe/Paris', flag: 'fr' },
      { name: 'Рим', country: 'Италия', tz: 'Europe/Rome', flag: 'it' },
      { name: 'Милан', country: 'Италия', tz: 'Europe/Rome', flag: 'it' },
      { name: 'Мадрид', country: 'Испания', tz: 'Europe/Madrid', flag: 'es' },
      { name: 'Барселона', country: 'Испания', tz: 'Europe/Madrid', flag: 'es' },
      { name: 'Лиссабон', country: 'Португалия', tz: 'Europe/Lisbon', flag: 'pt' },
      { name: 'Лондон', country: 'Великобритания', tz: 'Europe/London', flag: 'gb' },
      { name: 'Дублин', country: 'Ирландия', tz: 'Europe/Dublin', flag: 'ie' },
      { name: 'Амстердам', country: 'Нидерланды', tz: 'Europe/Amsterdam', flag: 'nl' },
      { name: 'Брюссель', country: 'Бельгия', tz: 'Europe/Brussels', flag: 'be' },
      { name: 'Вена', country: 'Австрия', tz: 'Europe/Vienna', flag: 'at' },
      { name: 'Будапешт', country: 'Венгрия', tz: 'Europe/Budapest', flag: 'hu' },
      { name: 'Афины', country: 'Греция', tz: 'Europe/Athens', flag: 'gr' },
      { name: 'Киев', country: 'Украина', tz: 'Europe/Kiev', flag: 'ua' },
      { name: 'Львов', country: 'Украина', tz: 'Europe/Kiev', flag: 'ua' },
      { name: 'Одесса', country: 'Украина', tz: 'Europe/Kiev', flag: 'ua' },
      { name: 'Минск', country: 'Беларусь', tz: 'Europe/Minsk', flag: 'by' },
      { name: 'Осло', country: 'Норвегия', tz: 'Europe/Oslo', flag: 'no' },
      { name: 'Стокгольм', country: 'Швеция', tz: 'Europe/Stockholm', flag: 'se' },
      { name: 'Хельсинки', country: 'Финляндия', tz: 'Europe/Helsinki', flag: 'fi' },
      { name: 'Копенгаген', country: 'Дания', tz: 'Europe/Copenhagen', flag: 'dk' },
      { name: 'Рейкьявик', country: 'Исландия', tz: 'Atlantic/Reykjavik', flag: 'is' },
      { name: 'Цюрих', country: 'Швейцария', tz: 'Europe/Zurich', flag: 'ch' },

      // --- РОССИЯ / СНГ ---
      { name: 'Москва', country: 'Россия', tz: 'Europe/Moscow', flag: 'ru' },
      { name: 'Санкт-Петербург', country: 'Россия', tz: 'Europe/Moscow', flag: 'ru' },
      { name: 'Новосибирск', country: 'Россия', tz: 'Asia/Novosibirsk', flag: 'ru' },
      { name: 'Екатеринбург', country: 'Россия', tz: 'Asia/Yekaterinburg', flag: 'ru' },
      { name: 'Казань', country: 'Россия', tz: 'Europe/Moscow', flag: 'ru' },
      { name: 'Владивосток', country: 'Россия', tz: 'Asia/Vladivostok', flag: 'ru' },
      { name: 'Калининград', country: 'Россия', tz: 'Europe/Kaliningrad', flag: 'ru' },
      { name: 'Ереван', country: 'Армения', tz: 'Asia/Yerevan', flag: 'am' },
      { name: 'Баку', country: 'Азербайджан', tz: 'Asia/Baku', flag: 'az' },
      { name: 'Тбилиси', country: 'Грузия', tz: 'Asia/Tbilisi', flag: 'ge' },
      { name: 'Астана', country: 'Казахстан', tz: 'Asia/Almaty', flag: 'kz' },
      { name: 'Алматы', country: 'Казахстан', tz: 'Asia/Almaty', flag: 'kz' },
      { name: 'Ташкент', country: 'Узбекистан', tz: 'Asia/Tashkent', flag: 'uz' },

      // --- Америка ---
      { name: 'Нью-Йорк', country: 'США', tz: 'America/New_York', flag: 'us' },
      { name: 'Вашингтон', country: 'США', tz: 'America/New_York', flag: 'us' },
      { name: 'Чикаго', country: 'США', tz: 'America/Chicago', flag: 'us' },
      { name: 'Лос-Анджелес', country: 'США', tz: 'America/Los_Angeles', flag: 'us' },
      { name: 'Сан-Франциско', country: 'США', tz: 'America/Los_Angeles', flag: 'us' },
      { name: 'Майами', country: 'США', tz: 'America/New_York', flag: 'us' },
      { name: 'Торонто', country: 'Канада', tz: 'America/Toronto', flag: 'ca' },
      { name: 'Ванкувер', country: 'Канада', tz: 'America/Vancouver', flag: 'ca' },
      { name: 'Мехико', country: 'Мексика', tz: 'America/Mexico_City', flag: 'mx' },
      { name: 'Буэнос-Айрес', country: 'Аргентина', tz: 'America/Argentina/Buenos_Aires', flag: 'ar' },
      { name: 'Сан-Паулу', country: 'Бразилия', tz: 'America/Sao_Paulo', flag: 'br' },

      // --- Азия ---
      { name: 'Токио', country: 'Япония', tz: 'Asia/Tokyo', flag: 'jp' },
      { name: 'Сеул', country: 'Южная Корея', tz: 'Asia/Seoul', flag: 'kr' },
      { name: 'Пекин', country: 'Китай', tz: 'Asia/Shanghai', flag: 'cn' },
      { name: 'Шанхай', country: 'Китай', tz: 'Asia/Shanghai', flag: 'cn' },
      { name: 'Гонконг', country: 'Гонконг', tz: 'Asia/Hong_Kong', flag: 'hk' },
      { name: 'Сингапур', country: 'Сингапур', tz: 'Asia/Singapore', flag: 'sg' },
      { name: 'Бангкок', country: 'Таиланд', tz: 'Asia/Bangkok', flag: 'th' },
      { name: 'Дубай', country: 'ОАЭ', tz: 'Asia/Dubai', flag: 'ae' },
      { name: 'Стамбул', country: 'Турция', tz: 'Europe/Istanbul', flag: 'tr' },
      { name: 'Тель-Авив', country: 'Израиль', tz: 'Asia/Jerusalem', flag: 'il' },

      // --- Австралия ---
      { name: 'Сидней', country: 'Австралия', tz: 'Australia/Sydney', flag: 'au' },
      { name: 'Мельбурн', country: 'Австралия', tz: 'Australia/Melbourne', flag: 'au' }
    ];

    function filterDB(q) {
      q = q.toLowerCase();
      return CITIES_DB.filter(x => x.name.toLowerCase().includes(q) || x.country.toLowerCase().includes(q)).slice(0, 3);
    }

    function renderSuggest(items) {
      sugg.innerHTML = '';
      if (!items.length) { sugg.classList.remove('visible'); return; }
      for (const it of items) {
        const el = document.createElement('div');
        el.className = 'opt';
        el.innerHTML = `<img class="flag" src="${flagURL(it.flag)}"><div><div>${it.name}</div><div class='country'>${it.country}</div></div>`;
        el.onclick = () => {
          if (!cities.some(c => c.tz === it.tz)) {
            cities.push(it);
            render();
            updateURL();
          }
          input.value = '';
          hideSuggest();
        };
        sugg.appendChild(el);
      }
      sugg.classList.add('visible');
    }

    function hideSuggest() { sugg.classList.remove('visible'); }
    input.oninput = () => renderSuggest(filterDB(input.value));
    input.onfocus = () => renderSuggest(filterDB(input.value));
    document.addEventListener('click', e => { if (!sugg.contains(e.target) && e.target !== input) hideSuggest(); });

    // --- SHARE LOGIC ---
    const shareBtn = document.getElementById('shareBtn');
    const popup = document.getElementById('sharePopup');
    const shareUrlInput = document.getElementById('shareUrlInput');
    const copyLinkBtn = document.getElementById('copyLinkBtn');
    const tooltipEl = document.getElementById('customTooltip');

    async function showSharePopup() {
      tooltipEl.classList.remove('visible');

      let longUrl = window.location.href;
      let shortUrl = longUrl;
      try {
        const r = await fetch(`https://is.gd/create.php?format=json&url=${encodeURIComponent(longUrl)}`);
        const data = await r.json();
        if (data.shorturl) shortUrl = data.shorturl;
      } catch (e) { }

      shareUrlInput.value = shortUrl;

      copyLinkBtn.onclick = () => {
        shareUrlInput.select();
        navigator.clipboard.writeText(shortUrl);
        copyLinkBtn.textContent = 'Copied!';
        copyLinkBtn.classList.add('copied');
        setTimeout(() => {
          copyLinkBtn.textContent = 'Copy';
          copyLinkBtn.classList.remove('copied');
        }, 2000);
      };

      const rect = shareBtn.getBoundingClientRect();
      const popupWidth = 340;
      let left = rect.left + rect.width / 2 - popupWidth / 2;
      if (left < 10) left = 10;
      if (left + popupWidth > window.innerWidth) left = window.innerWidth - popupWidth - 10;

      popup.style.left = left + "px";
      popup.style.top = rect.bottom + 8 + "px";
      popup.style.display = "flex";
    }

    // ОБРАБОТЧИК КЛИКА ПО КНОПКЕ ПОДЕЛИТЬСЯ (для всех устройств)
    shareBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      if (popup.style.display === 'flex') {
        popup.style.display = 'none';
      } else {
        showSharePopup();
      }
    });

    // Закрытие при клике вне
    document.addEventListener('click', (e) => {
      if (!popup.contains(e.target) && e.target !== shareBtn) popup.style.display = 'none';
    });

    function showTooltip(el) {
      if (!window.matchMedia('(hover: hover)').matches) return;
      if (popup.style.display === 'flex') return;

      const text = el.getAttribute('data-tip');
      if (!text) return;
      const rect = el.getBoundingClientRect();
      tooltipEl.textContent = text;
      tooltipEl.classList.add('visible');
      let top = rect.bottom + 8;
      let left = rect.left + (rect.width / 2) - (tooltipEl.offsetWidth / 2);
      if (left < 10) left = 10;
      if (left + tooltipEl.offsetWidth > window.innerWidth) left = window.innerWidth - tooltipEl.offsetWidth - 10;
      tooltipEl.style.top = `${top}px`;
      tooltipEl.style.left = `${left}px`;
    }

    document.body.addEventListener('mouseover', (e) => {
      const target = e.target.closest('[data-tip]');
      if (target) showTooltip(target);
    });
    document.body.addEventListener('mouseout', (e) => {
      const target = e.target.closest('[data-tip]');
      if (target) tooltipEl.classList.remove('visible');
    });
    document.body.addEventListener('click', (e) => {
      const target = e.target.closest('[data-tip]');
      if (target) tooltipEl.classList.remove('visible');
    });

    render(); tick(); setInterval(tick, 1000);
  </script>

  <link rel="stylesheet" href="footer.css">
  <div id="footer"></div>
  <script>
    fetch('footer.html')
      .then(r => r.text())
      .then(html => document.getElementById('footer').innerHTML = html);
  </script>

  <link rel="stylesheet" href="auth-widget.css">
  <script type="module" src="nav-widget.js"></script>
  <script type="module" src="auth-widget.js"></script>
  <script type="module" src="header.js"></script>
</body>

</html>