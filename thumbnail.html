<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>–°–∫–∞—á–∞—Ç—å YouTube –ø—Ä–µ–≤—å—é</title>
<meta name="description" content="–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø—Ä–µ–≤—å—é (–æ–±–ª–æ–∂–µ–∫) –∏–∑ YouTube –≤–∏–¥–µ–æ –≤ –≤—ã—Å–æ–∫–æ–º –∫–∞—á–µ—Å—Ç–≤–µ.">

<link rel="stylesheet" href="theme.css">

<style>
  /* === –õ–û–ö–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò === */
  /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ theme.css */
  
  :root {
      /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å */
  }

  .wrap { max-width: 850px; margin: 0 auto; padding: 22px 14px 40px; }
  
  h1 { margin: 0 0 14px; font-size: 1.4rem; text-align: center; color: var(--text); }
  
  /* --- Tabs --- */
  .tabs-container {
    display: flex; justify-content: center; margin-bottom: 20px;
  }
  .tabs {
    background: var(--card-bg);
    padding: 6px;
    border-radius: 12px;
    display: inline-flex;
    gap: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    border: 1px solid var(--border);
    max-width: 100%; overflow-x: auto; 
  }
  .tab-btn {
    border: none; background: transparent;
    padding: 10px 20px; border-radius: 10px;
    font-size: 0.95rem; font-weight: 600; cursor: pointer;
    color: var(--text-secondary);
    transition: all 0.2s ease;
    display: flex; align-items: center; gap: 8px; white-space: nowrap; 
  }
  .tab-btn svg { width: 18px; height: 18px; opacity: 0.7; flex-shrink: 0; fill: currentColor; }
  
  .tab-btn.active {
    background: var(--accent);
    color: #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }
  .tab-btn.active svg { opacity: 1; }
  .tab-btn:hover:not(.active) { background: var(--hover-bg); }

  /* --- –ö–∞—Ä—Ç–æ—á–∫–∞ --- */
  .card { 
      background: var(--card-bg); 
      border: 1px solid var(--border); 
      border-radius: 12px; 
      padding: 16px; 
      box-shadow: 0 1px 2px rgba(0,0,0,.03); 
  }
  .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: center; }
  
  /* --- –ü–æ–ª—è –≤–≤–æ–¥–∞ --- */
  input[type="url"] {
      width: 100%; 
      padding: 12px 14px;
      padding-right: 40px;
      font-size: 1rem;
      border-radius: 10px; 
      transition: border-color 0.2s;
      border: 1px solid var(--border); 
      background: var(--bg);
      color: var(--text);
  }
  
  input[type="url"]:focus { 
      outline: none; 
      border-color: var(--accent); 
      border-width: 2px;
      padding: 11px 13px; /* –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —à–∏—Ä–∏–Ω—ã —Ä–∞–º–∫–∏ */
      box-shadow: none;
  }
  
  input[type="url"]::placeholder { color: var(--text-secondary); opacity: 0.7; }

  .input-wrapper { position: relative; width: 100%; }

  /* Batch row */
  .batch-row {
      display: flex; align-items: center; gap: 10px; margin-bottom: 12px; width: 100%;
  }
  .batch-row .input-wrapper { flex: 1; }

  /* –ì–∞–ª–æ—á–∫–∞ */
  .check-icon {
    position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
    width: 18px; height: 18px; display: flex; align-items: center; justify-content: center;
    opacity: 0; transition: opacity 0.2s; pointer-events: none;
  }
  .check-icon svg { width: 100%; height: 100%; }
  .input-wrapper.valid .check-icon,
  .single-input-wrap.valid .check-icon { opacity: 1; }

  /* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è */
  .btn-remove {
      background: var(--bg);
      border: 1px solid transparent;
      border-radius: 8px;
      width: 42px; height: 42px; flex-shrink: 0;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      color: var(--text-secondary); transition: all 0.2s ease;
  }
  .btn-remove:hover { background: var(--hover-bg); color: var(--text); }
  .btn-remove svg { width: 20px; height: 20px; }

  .single-input-wrap { position: relative; width: 100%; flex: 1 1 560px; }

  .preview { margin-top: 16px; display: flex; justify-content: center; }
  .preview a { display: block; width: 100%; max-width: 850px; }
  .preview img { 
      width: 100%; height: auto; border-radius: 12px; 
      border: 1px solid var(--border); background: var(--bg); 
  }

  /* Info block */
  .info { 
      margin-top: 14px; 
      background: var(--bg); 
      border: 1px solid var(--border); 
      border-radius: 10px; padding: 12px; 
      color: var(--text);
  }
  .info .row2 { display: grid; gap: 6px; }
  .k { opacity: .8; min-width: 140px; display: inline-block; color: var(--text-secondary); }
  .err { color: #b00020; margin-top: 8px; }
  .muted { opacity: .7; font-size: .9rem; color: var(--text-secondary); }

  /* Controls */
  .batch-controls {
    display: flex; gap: 10px; margin-top: 10px; margin-bottom: 0; flex-wrap: wrap;
  }
  .btn {
    display: flex; align-items: center; justify-content: center; gap: 8px;
    padding: 12px 20px; border-radius: 10px; border: none;
    font-size: 1rem; cursor: pointer; font-weight: 500; transition: 0.2s; white-space: nowrap;
  }
  .btn-add { background: var(--bg); color: var(--text); flex: 1; border: 1px solid var(--border); }
  .btn-add:hover { background: var(--hover-bg); }
  
  .btn-dl { background: var(--accent); color: #fff; flex: 2; }
  .btn-dl:hover { background: var(--accent-hover); }

  .btn-edit {
      background: var(--card-bg);
      border: 1px solid var(--border);
      color: var(--text);
      width: 100%;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      white-space: nowrap; 
  }
  .btn-edit:hover { background: var(--hover-bg); }

  /* Results Header */
  .results-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 14px; margin-top: 24px; padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
  }
  .results-title {
      font-size: 1.1rem; font-weight: 700; margin: 0; color: var(--text);
  }
  .view-toggles {
      display: flex; background: var(--bg); border-radius: 8px; padding: 3px; gap: 2px;
  }
  .view-btn {
      border: none; background: transparent; border-radius: 6px;
      width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
      cursor: pointer; color: var(--text-secondary); transition: all 0.2s;
  }
  .view-btn:hover { color: var(--text); }
  .view-btn.active {
      background: var(--card-bg);
      color: var(--accent);
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }
  .view-btn svg { width: 18px; height: 18px; }

  /* Batch List */
  .batch-list { display: grid; gap: 16px; grid-template-columns: 1fr; }
  
  .batch-item {
    display: flex; gap: 16px; 
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px; padding: 10px;
    align-items: flex-start; transition: all 0.3s ease;
  }
  
  .batch-thumb-wrap {
    position: relative; width: 220px; flex-shrink: 0;
    border-radius: 8px; overflow: hidden;
    border: 1px solid var(--border); aspect-ratio: 16 / 9;
  }
  .batch-thumb-wrap img { width: 100%; height: 100%; object-fit: cover; display: block; }
  
  .batch-overlay {
    position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
    opacity: 0; transition: opacity 0.2s;
  }
  .batch-thumb-wrap:hover .batch-overlay { opacity: 1; }
  .dl-icon-btn {
    background: #fff; border-radius: 50%; width: 40px; height: 40px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  .batch-info { flex: 1; display: flex; flex-direction: column; justify-content: center; min-height: 120px; }
  .batch-title { font-weight: 600; font-size: 1.1rem; margin-bottom: 6px; line-height: 1.3; color: var(--text); }
  .batch-meta { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; }

  /* Gallery View */
  .batch-list.gallery-view { grid-template-columns: repeat(3, 1fr); }
  .batch-list.gallery-view .batch-item { flex-direction: column; gap: 10px; height: 100%; }
  .batch-list.gallery-view .batch-thumb-wrap { width: 100%; }
  .batch-list.gallery-view .batch-info { min-height: auto; justify-content: flex-start; }
  .batch-list.gallery-view .batch-title {
      font-size: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
  }

  @media (max-width: 800px) { .batch-list.gallery-view { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 600px) {
    .batch-item { flex-direction: column; }
    .batch-thumb-wrap { width: 100%; }
    .batch-info { min-height: auto; }
    .batch-list.gallery-view { grid-template-columns: 1fr; } 
  }
  @media (max-width: 480px) {
      .tab-btn { padding: 10px 12px; font-size: 0.85rem; }
      .batch-controls { flex-direction: column; }
      .btn { width: 100%; flex: auto; font-size: 0.95rem; }
  }

  [hidden] { display: none !important; }

  /* Tooltip (–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –≤ theme.css) */
  #customTooltip {
    position: fixed; background: var(--tooltip-bg); color: var(--tooltip-text);
    padding: 6px 12px; border-radius: 6px; font-size: 0.8rem;
    pointer-events: none; opacity: 0; transform: translateY(5px);
    transition: opacity 0.2s, transform 0.2s;
    z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); white-space: nowrap; font-weight: 500;
  }
  #customTooltip.visible { opacity: 1; transform: translateY(0); }
  @media (hover: none) { #customTooltip { display: none !important; } }
</style>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-384FKZ1NQP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-384FKZ1NQP');
</script>
</head>
<body>

<script src="theme-loader.js"></script>

<div id="header-container"></div>

<div id="customTooltip"></div>

<div class="wrap">
  <h1>–°–∫–∞—á–∞—Ç—å YouTube –ø—Ä–µ–≤—å—é</h1>

  <div class="tabs-container">
    <div class="tabs">
      <button class="tab-btn active" onclick="switchMode('single')">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path d="M19 15V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h13c1.1 0 2-.9 2-2M8 14V6l6 4z"/></svg>
        –û–¥–Ω–æ –≤–∏–¥–µ–æ
      </button>
      <button class="tab-btn" onclick="switchMode('batch')">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M4 8H2v12a2 2 0 0 0 2 2h12v-2H4z" fill="currentColor"/><path d="M20 2H8a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zm-9 12V6l7 4z" fill="currentColor"/></svg>
        –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
      </button>
    </div>
  </div>

  <div class="card">
    
    <div id="singleMode">
      <div class="row">
        <div class="single-input-wrap" id="singleInputWrap">
            <input id="yturl" type="url" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ..." autocomplete="off">
            <div class="check-icon">
                <svg viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="12" fill="#4CAF50"/>
                    <path d="M17.3 8.3L9.5 16.1L6.7 13.3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </div>
      </div>

      <div class="preview" id="out" hidden>
        <a id="thumbLink" target="_blank" rel="noopener">
          <img id="thumb" alt="–ü—Ä–µ–≤—å—é YouTube">
        </a>
      </div>

      <div id="videoInfo" class="info" hidden>
        <div class="row2" id="infoRows"></div>
        <div id="apiErr" class="err" hidden></div>
      </div>
    </div>

    <div id="batchMode" hidden>
      <div id="batchInputs"></div>

      <div class="batch-controls">
        <button class="btn btn-add" onclick="addBatchInput()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            –î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ
        </button>
        <button class="btn btn-dl" onclick="processBatch()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            –°–∫–∞—á–∞—Ç—å –≤—Å–µ
        </button>
      </div>

      <div id="batchErr" class="err" hidden style="margin-top:10px;text-align:center;"></div>
      
      <button id="editBatchBtn" class="btn btn-edit" onclick="editBatchLinks()" hidden>
         <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 20 20"><title>Reload SVG Icon</title><path fill="currentColor" d="M15.65 4.35A8 8 0 1 0 17.4 13h-2.22a6 6 0 1 1-1-7.22L11 9h7V2z"/></svg>
         –ù–∞–π—Ç–∏ –µ—â—ë
      </button>

      <div id="resultsHeader" class="results-header" hidden>
          <h2 class="results-title">–ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ–±–ª–æ–∂–∫–∏</h2>
          <div class="view-toggles">
              <button class="view-btn active" id="btnGallery" onclick="setView('gallery')" data-tip="–ì–∞–ª–µ—Ä–µ—è">
                  <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 10h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 16h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4z"></path></svg>
              </button>
              <button class="view-btn" id="btnList" onclick="setView('list')" data-tip="–°–ø–∏—Å–æ–∫">
                  <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"></path></svg>
              </button>
          </div>
      </div>

      <div id="batchResults" class="batch-list gallery-view"></div>
    </div>

  </div>
</div>

<script>
  // üîë –í–°–¢–ê–í–¨–¢–ï –°–í–û–ô API KEY (YouTube Data API v3)
  const API_KEY = "AIzaSyCeQA2-I2pGKQwStB1TN8NQOQcKdgqc7_0";

  /* ================= TOOLTIPS ================= */
  const tooltipEl = document.getElementById('customTooltip');
  function initTooltips() {
      const elements = document.querySelectorAll('[data-tip]');
      elements.forEach(el => {
          // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏, –∫–ª–æ–Ω–∏—Ä—É—è —ç–ª–µ–º–µ–Ω—Ç
          const newEl = el.cloneNode(true);
          el.parentNode.replaceChild(newEl, el);
          attachTooltip(newEl);
      });
  }
  function attachTooltip(el) {
      el.addEventListener('mouseenter', showTip);
      el.addEventListener('mouseleave', hideTip);
      el.addEventListener('click', hideTip);
  }
  function showTip(e) {
      const el = e.currentTarget;
      const text = el.getAttribute('data-tip');
      if (!text) return;
      const rect = el.getBoundingClientRect();
      tooltipEl.textContent = text;
      tooltipEl.classList.add('visible');
      let top = rect.bottom + 8;
      let left = rect.left + (rect.width / 2) - (tooltipEl.offsetWidth / 2);
      if (left < 10) left = 10;
      if (left + tooltipEl.offsetWidth > window.innerWidth) {
          left = window.innerWidth - tooltipEl.offsetWidth - 10;
      }
      tooltipEl.style.top = `${top}px`;
      tooltipEl.style.left = `${left}px`;
  }
  function hideTip() { tooltipEl.classList.remove('visible'); }
  
  initTooltips();

  /* ================= GLOBALS & UTILS ================= */
  function parseYouTubeId(url){
    if (!url) return null;
    try{
      const u = new URL(url.trim());
      if (u.hostname.endsWith('youtu.be')) return u.pathname.split('/')[1] || null;
      if (u.searchParams.get('v')) return u.searchParams.get('v');
      if (u.pathname.startsWith('/shorts/')) return u.pathname.split('/')[2] || null;
      if (u.pathname.startsWith('/embed/'))  return u.pathname.split('/')[2] || null;
      return null;
    }catch{ return null; }
  }

  function formatMoscow(dtISO){
    const d = new Date(dtISO);
    const optsDate = { year:'numeric', month:'long', day:'numeric' };
    const optsTime = { hour:'2-digit', minute:'2-digit' };
    const date = d.toLocaleDateString('ru-RU', {...optsDate, timeZone:'Europe/Moscow'});
    const time = d.toLocaleTimeString('ru-RU', {...optsTime, timeZone:'Europe/Moscow'});
    return `${date} –≤ ${time} –ø–æ –º—Å–∫`;
  }
  
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  /* ================= LOGIC: TABS ================= */
  function switchMode(mode) {
    const btns = document.querySelectorAll('.tab-btn');
    const single = document.getElementById('singleMode');
    const batch = document.getElementById('batchMode');

    if(mode === 'single') {
        btns[0].classList.add('active');
        btns[1].classList.remove('active');
        single.hidden = false;
        batch.hidden = true;
    } else {
        btns[0].classList.remove('active');
        btns[1].classList.add('active');
        single.hidden = true;
        batch.hidden = false;
        const container = document.getElementById('batchInputs');
        if(container.children.length === 0) {
            addBatchInput();
            addBatchInput();
        }
    }
  }

  /* ================= LOGIC: VIEW SWITCHER ================= */
  function setView(viewType) {
      const listContainer = document.getElementById('batchResults');
      const btnList = document.getElementById('btnList');
      const btnGallery = document.getElementById('btnGallery');

      if (viewType === 'gallery') {
          listContainer.classList.add('gallery-view');
          btnGallery.classList.add('active');
          btnList.classList.remove('active');
      } else {
          listContainer.classList.remove('gallery-view');
          btnList.classList.add('active');
          btnGallery.classList.remove('active');
      }
  }

  /* ================= LOGIC: SINGLE MODE ================= */
  const input = document.getElementById('yturl');
  const inputWrap = document.getElementById('singleInputWrap');
  const out    = document.getElementById('out');
  const img    = document.getElementById('thumb');
  const link   = document.getElementById('thumbLink');
  const infoBox    = document.getElementById('videoInfo');
  const infoRows   = document.getElementById('infoRows');
  const apiErrEl   = document.getElementById('apiErr');
  const placeholder = "https://placehold.co/800x450?text=–í—Å—Ç–∞–≤—å—Ç–µ+—Å—Å—ã–ª–∫—É,+—á—Ç–æ–±—ã+—Å–∫–∞—á–∞—Ç—å+–ø—Ä–µ–≤—å—é&font=roboto";

  img.src = placeholder;
  out.hidden = false;
  link.removeAttribute("href");
  link.style.pointerEvents = "none";
  link.style.cursor = "default";

  async function fetchVideoMeta(id){
    if (!API_KEY || API_KEY === 'YOUR_API_KEY_HERE') throw new Error('–ù–µ —É–∫–∞–∑–∞–Ω API –∫–ª—é—á.');
    const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${id}&key=${API_KEY}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`API Error`);
    const data = await res.json();
    if (!data.items || !data.items.length) throw new Error('–í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
    return data.items[0];
  }

  let t;
  function updateSingle(){
    clearTimeout(t);
    t = setTimeout(async ()=>{
      apiErrEl.hidden = true; 
      apiErrEl.textContent = '';
      const id = parseYouTubeId(input.value);

      if (!id){
        inputWrap.classList.remove('valid'); 
        img.src = placeholder;
        link.removeAttribute("href");
        link.style.pointerEvents = "none";
        link.style.cursor = "default";
        infoBox.hidden = true;
        return;
      }

      inputWrap.classList.add('valid'); 

      const max = `https://i.ytimg.com/vi/${id}/maxresdefault.jpg`;
      const hq  = `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;
      img.src = max;
      link.href = max;
      link.style.pointerEvents = "auto";
      link.style.cursor = "pointer";
      img.onerror = () => { 
        img.onerror = null; 
        img.src = hq; 
        link.href = hq; 
      };

      try {
        const item = await fetchVideoMeta(id);
        const s = item.snippet;
        const dateStr = s.publishedAt ? formatMoscow(s.publishedAt) : '‚Äî';
        infoRows.innerHTML = `
          <div><span class="k"><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong></span> ${escapeHtml(s.title)}</div>
          <div><span class="k"><strong>–ö–∞–Ω–∞–ª:</strong></span> ${escapeHtml(s.channelTitle)}</div>
          <div><span class="k"><strong>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</strong></span> ${dateStr}</div>
        `;
        infoBox.hidden = false;
      } catch(err) {
        infoBox.hidden = false;
        infoRows.innerHTML = '';
        apiErrEl.textContent = err.message || String(err);
        apiErrEl.hidden = false;
      }
    }, 250);
  }

  input.addEventListener('input', updateSingle);
  (function(){
    const q = new URLSearchParams(location.search).get('url');
    if (q){ input.value = q; updateSingle(); }
  })();


  /* ================= LOGIC: BATCH MODE ================= */
  function addBatchInput() {
      const container = document.getElementById('batchInputs');
      const row = document.createElement('div');
      row.className = 'batch-row';
      
      row.innerHTML = `
        <div class="input-wrapper">
            <input type="url" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ..." oninput="checkBatchInput(this)">
            <div class="check-icon">
                <svg viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="12" fill="#4CAF50"/>
                    <path d="M17.3 8.3L9.5 16.1L6.7 13.3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </div>
        <button class="btn-remove" onclick="removeInput(this)" data-tip="–£–¥–∞–ª–∏—Ç—å">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
      `;
      container.appendChild(row);
      attachTooltip(row.querySelector('.btn-remove'));
  }

  function removeInput(btn) {
      const row = btn.parentElement; 
      row.remove();
      hideTip();
  }

  function checkBatchInput(el) {
    const parent = el.parentElement; 
    const id = parseYouTubeId(el.value);
    if(id) parent.classList.add('valid');
    else parent.classList.remove('valid');
  }

  function editBatchLinks() {
      document.getElementById('batchInputs').hidden = false;
      document.querySelector('.batch-controls').hidden = false;
      document.getElementById('editBatchBtn').hidden = true;
  }

  async function processBatch() {
      const container = document.getElementById('batchInputs');
      const inputs = container.querySelectorAll('input');
      const resultsDiv = document.getElementById('batchResults');
      const errDiv = document.getElementById('batchErr');
      const headerDiv = document.getElementById('resultsHeader');
      const editBtn = document.getElementById('editBatchBtn');
      
      resultsDiv.innerHTML = '';
      errDiv.hidden = true;
      headerDiv.hidden = true; 

      let ids = [];
      inputs.forEach(inp => {
          const id = parseYouTubeId(inp.value);
          if(id) ids.push(id);
      });

      if(ids.length === 0) {
          errDiv.textContent = '–í—Å—Ç–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É.';
          errDiv.hidden = false;
          return;
      }

      container.hidden = true;
      document.querySelector('.batch-controls').hidden = true;
      editBtn.hidden = false;

      const idsString = ids.join(',');
      const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${idsString}&key=${API_KEY}`;

      try {
          const res = await fetch(url);
          if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ API');
          const data = await res.json();
          
          if (!data.items) throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö');

          const itemMap = {};
          data.items.forEach(item => { itemMap[item.id] = item; });
          
          headerDiv.hidden = false;

          ids.forEach(id => {
              const item = itemMap[id];
              const max = `https://i.ytimg.com/vi/${id}/maxresdefault.jpg`;
              const hq = `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;

              let title = "–í–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –∏–ª–∏ —Å–∫—Ä—ã—Ç–æ";
              let channel = "‚Äî";
              let dateStr = "‚Äî";

              if(item && item.snippet) {
                  title = item.snippet.title;
                  channel = item.snippet.channelTitle;
                  dateStr = item.snippet.publishedAt ? formatMoscow(item.snippet.publishedAt) : '‚Äî';
              }

              const html = `
                <div class="batch-item">
                    <div class="batch-thumb-wrap">
                        <img src="${max}" onerror="this.src='${hq}'" alt="Thumb">
                        <a href="${max}" target="_blank" class="batch-overlay">
                            <div class="dl-icon-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#6200ee" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            </div>
                        </a>
                    </div>
                    <div class="batch-info">
                        <div class="batch-title">${escapeHtml(title)}</div>
                        <div class="batch-meta">
                            <div>–ö–∞–Ω–∞–ª: ${escapeHtml(channel)}</div>
                            <div>${dateStr}</div>
                        </div>
                    </div>
                </div>
              `;
              resultsDiv.insertAdjacentHTML('beforeend', html);
          });

      } catch(e) {
          errDiv.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + e.message;
          errDiv.hidden = false;
          editBatchLinks();
      }
  }

</script>

<link rel="stylesheet" href="footer.css">
<div id="footer"></div>
<script>
fetch('footer.html')
.then(r => r.text())
.then(html => { if(html) document.getElementById('footer').innerHTML = html; })
.catch(() => {});
</script>

<link rel="stylesheet" href="auth-widget.css">
<script type="module" src="nav-widget.js"></script> 
<script type="module" src="auth-widget.js"></script>
<script type="module" src="header.js"></script>
  
</body>
</html>