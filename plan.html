<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞–Ω –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üé¨</text></svg>">
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #F2F2F7;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            margin: 0;
            font-size: 1.5rem;
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .controls {
            display: flex;
            gap: 15px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            color: white;
            background-color: var(--primary-color);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        button svg {
            width: 18px;
            height: 18px;
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-load {
            background-color: #10b948;
        }

        .btn-add-thesis {
            width: 100%;
            max-width: 400px;
            padding: 12px 20px;
            font-size: 1rem;
        }

        .section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: flex;
            align-items: center;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        /* –ò–∫–æ–Ω–∫–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
        .info-icon {
            margin-left: 8px;
            width: 18px;
            height: 18px;
            background: #e0e7ff;
            color: var(--primary-color);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: help;
            position: relative;
        }

        /* –¢–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
        .info-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            width: 280px;
            background: #334155;
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            z-index: 100;
            white-space: normal;
            line-height: 1.4;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        }

        /* Toggle Switch iOS Style */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding: 10px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toggle-container:hover {
            background: #f8fafc;
        }

        .toggle-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-color);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e2e8f0;
            transition: .3s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        input:checked+.slider {
            background-color: #34c759;
        }

        input:checked+.slider:before {
            transform: translateX(20px);
        }

        .comment-group {
            display: none;
        }

        .comment-group.visible {
            display: block;
        }

        .grid-info.wide {
            grid-template-columns: 1fr;
        }

        .grid-info.with-comment {
            grid-template-columns: 2.5fr 1fr;
        }

        input,
        select,
        .rich-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            box-sizing: border-box;
            background: #fff;
        }

        select {
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%234b5563' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m3 4.5 3 3 3-3'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 30px;
            cursor: pointer;
        }

        .rich-textarea {
            min-height: 80px;
            cursor: text;
            white-space: pre-wrap;
            overflow-wrap: anywhere;
            transition: all 0.2s;
            line-height: 1.5;
            max-width: 100%;
            width: 100%;
        }

        .rich-textarea:empty:before {
            content: attr(placeholder);
            color: #94a3b8;
            pointer-events: none;
            display: block;
        }

        input:focus,
        select:focus,
        .rich-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea {
            display: none;
            /* –ú—ã –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ textarea */
        }

        select.filled {
            background-color: #dcfce7;
            color: #166534;
            border-color: #bbf7d0;
            font-weight: 600;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-info {
            display: grid;
            grid-template-columns: 2.5fr 1fr;
            gap: 20px;
        }

        .grid-cover {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        @media(max-width: 700px) {

            .grid-2,
            .grid-cover {
                grid-template-columns: 1fr;
            }
        }

        .section-divider {
            border: none;
            height: 1px;
            background: linear-gradient(to right, transparent, #bdbdbda1, transparent);
            margin: 20px auto;
            width: 100%;
        }

        .thesis-block {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 5px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .thesis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .thesis-title {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 5px;
            flex-grow: 1;
        }

        .thesis-name-input {
            padding: 8px 5px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            background: #fff;
            width: 89%;
            max-width: none;
            transition: all 0.2s;
            min-height: 1.4em;
            line-height: 1.4;
            word-wrap: break-word;
            display: inline-block;
            vertical-align: middle;
        }

        #title {
            width: 100%;
        }

        .thesis-name-input:empty:before {
            content: attr(placeholder);
            color: #94a3b8;
            font-weight: 400;
            pointer-events: none;
        }

        .thesis-name-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–µ–Ω—é "—Ç—Ä–∏ —Ç–æ—á–∫–∏" */
        .menu-container {
            position: relative;
            display: inline-block;
        }

        .menu-dots {
            background: none;
            color: #94a3b8;
            padding: 5px 10px;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            height: auto;
            width: auto;
        }

        .menu-dots:hover {
            color: var(--text-color);
            background: #f1f5f9;
        }

        .menu-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: white;
            min-width: 150px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15);
            z-index: 100;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-top: 5px;
            overflow: hidden;
        }

        .menu-content button {
            color: #ef4444;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            width: 100%;
            text-align: left;
            background: none;
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
            border-radius: 0;
        }

        .menu-content button:hover {
            background-color: #fef2f2;
            opacity: 1;
        }

        .menu-content .menu-item {
            border-bottom: 1px solid var(--border-color);
        }

        .menu-content .menu-item:last-child {
            border-bottom: none;
        }

        .menu-content button.btn-delete {
            color: #ef4444;
        }

        .show {
            display: block;
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Toasts) */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            background: #334155;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease-out;
        }

        .toast.success {
            background: #10b981;
        }

        .toast.error {
            background: #ef4444;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(2px);
        }

        .modal {
            background: white;
            padding: 24px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15);
        }

        .modal h3 {
            margin-top: 0;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #64748b;
        }

        .btn-danger {
            background: #ef4444;
        }

        .modal input {
            margin-top: 15px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–±–ª–æ–∂–∫–∏ */
        .cover-container {
            width: 400px;
            aspect-ratio: 16 / 9;
            background: #f1f5f9;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cover-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .upload-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .cover-container:hover .upload-overlay {
            opacity: 1;
        }

        .upload-icon-btn {
            background: rgba(255, 255, 255, 0.9);
            color: var(--primary-color);
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
            border: none;
        }

        .upload-icon-btn:hover {
            transform: scale(1.1);
            background: #fff;
        }

        .upload-icon-btn svg {
            width: 20px;
            height: 20px;
        }

        .loader {
            width: 24px;
            height: 24px;
            border: 3px solid #FFF;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: none;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <header class="header-bar">
            <h1>–ü–ª–∞–Ω –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è</h1>
            <div class="controls">
                <button onclick="saveData()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞–Ω
                </button>
                <button class="btn-load" onclick="document.getElementById('fileInput').click()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞
                </button>
                <input type="file" id="fileInput" accept=".json" style="display: none" onchange="loadData(this)">
            </div>
        </header>

        <form id="planForm">

            <div class="section">
                <!-- –û–±–ª–æ–∂–∫–∞ —Å–≤–µ—Ä—Ö—É -->
                <div class="form-group"
                    style="display: flex; flex-direction: column; align-items: center; margin-bottom: 30px;">
                    <label style="margin-bottom: 10px;">–û–±–ª–æ–∂–∫–∞
                        <span class="info-icon"
                            data-tooltip="–í —ç—Ç–æ–º –±–ª–æ–∫–µ —Ä–∞–∑–º–µ—â–µ–Ω —ç—Å–∫–∏–∑ –ø—Ä–µ–≤—å—é, —á—Ç–æ–±—ã –±—ã–ª–æ –Ω–∞–≥–ª—è–¥–Ω–æ —è—Å–Ω–æ, –∫–∞–∫ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –æ–±–ª–æ–∂–∫–∞.">?</span>
                    </label>
                    <div class="cover-container" id="coverContainer" style="margin-bottom: 0;">
                        <img id="coverPreview"
                            src="https://placehold.co/800x450?text=%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%B8%D1%82%D0%B5+%D0%9F%D1%80%D0%B5%D0%B2%D1%8C%D1%8E"
                            class="cover-preview" draggable="false">
                        <div class="upload-overlay">
                            <input type="file" id="coverInput" accept="image/*" style="display: none"
                                onchange="uploadImage(this)">
                            <button type="button" class="upload-icon-btn"
                                onclick="document.getElementById('coverInput').click()" id="uploadBtn"
                                title="–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±–ª–æ–∂–∫—É">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                            </button>
                            <span class="loader" id="uploadLoader"
                                style="background: rgba(0,0,0,0.5); padding: 5px; border-radius: 50%;"></span>
                        </div>
                        <input type="hidden" id="coverUrl">
                    </div>
                </div>

                <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –•—Ä–æ–Ω–æ–º–µ—Ç—Ä–∞–∂ -->
                <div class="grid-info" style="align-items: flex-start; margin-bottom: 25px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ
                            <span class="info-icon"
                                data-tooltip="–£–∫–∞–∑—ã–≤–∞–µ–º –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π/—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫. –ö–∞–∫ –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è –≤–∏–¥–µ–æ?">?</span>
                        </label>
                        <div id="title" class="thesis-name-input" contenteditable="true"
                            placeholder="–ö–∞–∫ –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è –≤–∏–¥–µ–æ?"></div>
                    </div>

                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–•—Ä–æ–Ω–æ–º–µ—Ç—Ä–∞–∂ –≤–∏–¥–µ–æ
                            <span class="info-icon"
                                data-tooltip="–ò—Ç–æ–≥–æ–≤–∞—è –¥–ª–∏–Ω–∞ —Ä–æ–ª–∏–∫–∞, –æ—Å–Ω–æ–≤—ã–≤–∞–Ω–Ω–∞—è –∏—Å—Ö–æ–¥—è –∏–∑ —Å—Ä–µ–¥–Ω–µ–≥–æ —Ö—Ä–æ–Ω–æ–º–µ—Ç—Ä–∞–∂–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –≤ –Ω–∏—à–µ.">?</span>
                        </label>
                        <select id="duration" style="width: 100%;" onchange="handleCustomSelect(this)">
                            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
                            <option value="8 - 10 –º–∏–Ω—É—Ç">8 - 10 –º–∏–Ω—É—Ç</option>
                            <option value="10 - 12 –º–∏–Ω—É—Ç">10 - 12 –º–∏–Ω—É—Ç</option>
                            <option value="12 - 14 –º–∏–Ω—É—Ç">12 - 14 –º–∏–Ω—É—Ç</option>
                            <option value="14 - 16 –º–∏–Ω—É—Ç">14 - 16 –º–∏–Ω—É—Ç</option>
                            <option value="16+ –º–∏–Ω—É—Ç">16+ –º–∏–Ω—É—Ç</option>
                            <option value="custom">–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç...</option>
                        </select>
                    </div>
                </div>

                <!-- –¢–ó –∏ –û –≤–∏–¥–µ–æ -->
                <div class="grid-2">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–¢–∑ –¥–ª—è –ø—Ä–µ–≤—å—é
                            <span class="info-icon"
                                data-tooltip="–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –ø—Ä–µ–≤—å—é. –ó–¥–µ—Å—å –≤–∞–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —ç–º–æ—Ü–∏—é –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ñ–æ—Ç–æ –∞–≤—Ç–æ—Ä–∞.">?</span>
                        </label>
                        <div id="preview" class="rich-textarea" contenteditable="true" placeholder=""></div>
                    </div>

                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–û –≤–∏–¥–µ–æ
                            <span class="info-icon" data-tooltip="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—Å—ã–≤–∞–µ–º —Å—É—Ç—å –≤–∏–¥–µ–æ.">?</span>
                        </label>
                        <div id="producer_comment" class="rich-textarea" contenteditable="true" placeholder=""></div>
                    </div>
                </div>
            </div>
            <hr class="section-divider">
            <div class="section">
                <div class="thesis-header">
                    <div style="font-weight: 600; font-size: 1.1rem; display: flex; align-items: center;">
                        –ò–Ω—Ç—Ä–æ
                        <span class="info-icon"
                            data-tooltip="–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Å–∞–º—É—é –ø–æ—Å–ª–µ–¥–Ω—é—é –æ—á–µ—Ä–µ–¥—å. –ö–æ–≥–¥–∞ –ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–æ–π –±–∞–π—Ç –±—É–¥–µ—Ç –Ω–∞ –ø—Ä–µ–≤—å—é, –∫–∞–∫ –µ–≥–æ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º –≤ –≤–∏–¥–µ–æ –∏ –Ω–∞ —á—Ç–æ —Å–¥–µ–ª–∞—Ç—å –∞–∫—Ü–µ–Ω—Ç, —á—Ç–æ–± –∑—Ä–∏—Ç–µ–ª—å –¥–æ—Å–º–æ—Ç—Ä–µ–ª –≤–∏–¥–µ–æ –¥–æ —Å–∞–º–æ–≥–æ –∫–æ–Ω—Ü–∞.">?</span>
                    </div>
                    <div class="menu-container">
                        <button type="button" class="menu-dots" onclick="toggleMenu('intro')">‚ãÆ</button>
                        <div id="menu_intro" class="menu-content">
                            <div class="menu-item">
                                <label class="toggle-container" onclick="event.stopPropagation()">
                                    <span class="toggle-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</span>
                                    <div class="toggle-switch">
                                        <input type="checkbox" id="toggle_intro"
                                            onchange="toggleComment('intro', this.checked)">
                                        <span class="slider"></span>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid-info wide" id="grid_intro">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–¢–µ–∫—Å—Ç –∞–≤—Ç–æ—Ä–∞</label>
                        <div id="intro" class="rich-textarea" contenteditable="true"
                            placeholder="–ü—Ä—è–º–∞—è —Ä–µ—á—å –∞–≤—Ç–æ—Ä–∞. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ–± –∑—Ä–∏—Ç–µ–ª—å –¥–æ—Å–º–æ—Ç—Ä–µ–ª –≤–∏–¥–µ–æ –¥–æ —Å–∞–º–æ–≥–æ –∫–æ–Ω—Ü–∞?">
                        </div>
                    </div>
                    <div class="form-group comment-group" id="group_intro_comment" style="margin-bottom: 0;">
                        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                        <div id="intro_comment" class="rich-textarea" contenteditable="true"></div>
                    </div>
                </div>
            </div>

            <hr class="section-divider">

            <div id="theses-container"></div>

            <div style="text-align: center; margin-bottom: 25px; margin-top: 20px;">
                <button type="button" class="btn-load btn-add-thesis" onclick="addThesis()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫
                </button>
            </div>

            <hr class="section-divider">

            <div class="section">
                <div class="thesis-header">
                    <div style="font-weight: 600; font-size: 1.1rem; display: flex; align-items: center;">
                        –ó–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å
                        <span class="info-icon"
                            data-tooltip="–í –¥–∞–Ω–Ω–æ–º –±–ª–æ–∫–µ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –ù–ï —Ä–∞–∑–º–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω—Ü–æ–≤–∫—É. –ú–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø—Ä–∏–∑–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ —Ä–æ–ª–∏–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª–µ.">?</span>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="outro_duration" style="width: 160px;" onchange="handleCustomSelect(this)">
                            <option value="" disabled selected>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
                            <option value="20 —Å–µ–∫">20 —Å–µ–∫</option>
                            <option value="30 - 60 —Å–µ–∫">30 - 60 —Å–µ–∫</option>
                            <option value="60 - 90 —Å–µ–∫">60 - 90 —Å–µ–∫</option>
                            <option value="2 –º–∏–Ω—É—Ç—ã">2 –º–∏–Ω—É—Ç—ã</option>
                            <option value="custom">–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç...</option>
                        </select>
                        <div class="menu-container">
                            <button type="button" class="menu-dots" onclick="toggleMenu('outro')">‚ãÆ</button>
                            <div id="menu_outro" class="menu-content">
                                <div class="menu-item">
                                    <label class="toggle-container" onclick="event.stopPropagation()">
                                        <span class="toggle-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</span>
                                        <div class="toggle-switch">
                                            <input type="checkbox" id="toggle_outro"
                                                onchange="toggleComment('outro', this.checked)">
                                            <span class="slider"></span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid-info wide" id="grid_outro">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–¢–µ–∫—Å—Ç –∞–≤—Ç–æ—Ä–∞</label>
                        <div id="outro" class="rich-textarea" contenteditable="true" placeholder=""></div>
                    </div>

                    <div class="form-group comment-group" id="group_outro_comment" style="margin-bottom: 0;">
                        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                        <div id="outro_comment" class="rich-textarea" contenteditable="true" placeholder=""></div>
                    </div>
                </div>
            </div>

        </form>
    </div>

    <div id="toast-container"></div>

    <div id="confirmModal" class="modal-overlay">
        <div class="modal">
            <h3 id="modalTitle">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            <p id="modalText"></p>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeModal('confirmModal')">–û—Ç–º–µ–Ω–∞</button>
                <button id="confirmBtn" class="btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="promptModal" class="modal-overlay">
        <div class="modal">
            <h3>–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç</h3>
            <p>–í–≤–µ–¥–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5-7 –º–∏–Ω—É—Ç):</p>
            <input type="text" id="promptInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ...">
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeModal('promptModal')">–û—Ç–º–µ–Ω–∞</button>
                <button id="promptBtn">–ì–æ—Ç–æ–≤–æ</button>
            </div>
        </div>
    </div>

    <script>
        // –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function openModal(id) {
            document.getElementById(id).style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
        function handleCustomSelect(select) {
            updateSelectStyle(select);
            if (select.value === 'custom') {
                const input = document.getElementById('promptInput');
                input.value = '';
                openModal('promptModal');

                document.getElementById('promptBtn').onclick = () => {
                    const customValue = input.value.trim();
                    if (customValue) {
                        const newOpt = document.createElement('option');
                        newOpt.value = customValue;
                        newOpt.text = customValue;
                        newOpt.selected = true;
                        select.add(newOpt, select.options[select.options.length - 1]);
                        closeModal('promptModal');
                        updateSelectStyle(select);
                    }
                };

                // –°–±—Ä–æ—Å –µ—Å–ª–∏ –∑–∞–∫—Ä—ã–ª–∏ –±–µ–∑ –≤–≤–æ–¥–∞
                const cancelBtn = document.querySelector('#promptModal .btn-secondary');
                const oldCancel = cancelBtn.onclick;
                cancelBtn.onclick = () => {
                    select.selectedIndex = 0;
                    closeModal('promptModal');
                    cancelBtn.onclick = oldCancel;
                };
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è textarea
        function autoExpand(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–Ω—é
        function toggleMenu(id) {
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –º–µ–Ω—é
            document.querySelectorAll('.menu-content').forEach(menu => {
                if (menu.id !== `menu_${id}`) menu.classList.remove('show');
            });
            const menu = document.getElementById(`menu_${id}`);
            if (menu) menu.classList.toggle("show");
        }

        // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        function toggleComment(sectionId, isVisible) {
            const group = document.getElementById(`group_${sectionId}_comment`);
            const grid = document.getElementById(`grid_${sectionId}`);

            if (isVisible) {
                group.classList.add('visible');
                grid.classList.remove('wide');
                grid.classList.add('with-comment');
            } else {
                group.classList.remove('visible');
                grid.classList.add('wide');
                grid.classList.remove('with-comment');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
        window.onclick = function (event) {
            if (!event.target.matches('.menu-dots')) {
                document.querySelectorAll('.menu-content').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ ImgBB
        async function uploadImage(input) {
            const file = input.files[0];
            if (!file) return;

            const apiKey = 'fbd88ce7045582e4c4176c67de93ceee';
            const formData = new FormData();
            formData.append('image', file);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
            const loader = document.getElementById('uploadLoader');
            const btn = document.getElementById('uploadBtn');
            loader.style.display = 'inline-block';
            btn.style.display = 'none';

            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    const url = result.data.url;
                    document.getElementById('coverUrl').value = url;
                    document.getElementById('coverPreview').src = url;
                    showToast('–û–±–ª–æ–∂–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ API');
                }
            } catch (err) {
                console.error(err);
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
            } finally {
                loader.style.display = 'none';
                btn.style.display = 'inline-block';
                input.value = '';
            }
        }

        let currentThesisCount = 0;
        const container = document.getElementById('theses-container');

        // –¢–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –í–°–ï–• —Ç–µ–∑–∏—Å–æ–≤ (–∏–∑ —Ç–∞–±–ª–∏—Ü—ã)
        const thesisTooltipText = "–í –¥–∞–Ω–Ω—ã—Ö –±–ª–æ–∫–∞—Ö –∞–≤—Ç–æ—Ä –≤–∏–¥–µ–æ –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫—Ä–∞—Ç–∫–∏–µ —Ç–µ–∑–∏—Å—ã –∏ –∫–ª—é—á–µ–≤—ã–µ –ø–æ–∏–Ω—Ç—ã –æ —Ç–æ–º, —á—Ç–æ –æ–Ω –º–æ–∂–µ—Ç —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é —Ç–µ–º—É. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≥—Ä—É–±—ã–π –Ω–∞–±—Ä–æ—Å–æ–∫, –≤—Å–µ, —á—Ç–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –≥–æ–ª–æ–≤–µ. –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—Å–µ —Ç–µ–∑–∏—Å—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã - –ø—Ä–æ–¥—é—Å–µ—Ä —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏—Ö –≤ –ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ, –¥–æ–±–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–µ/–Ω–∞–≤–æ–¥—è—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), —á—Ç–æ–± —Ä–∞—Å–∫—Ä—ã—Ç—å —Ç–µ–º—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ. –†—è–¥–æ–º —Å –∫–∞–∂–¥—ã–º —Ç–µ–∑–∏—Å–æ–º —Ç–∞–∫–∂–µ –≤–∞–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ö—Ä–æ–Ω–æ–º–µ—Ç—Ä–∞–∂.";

        // –í–∞—Ä–∏–∞–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ç–µ–∑–∏—Å–æ–≤
        const timeOptions = [
            "20 —Å–µ–∫",
            "30 - 60 —Å–µ–∫",
            "60 - 90 —Å–µ–∫",
            "2 –º–∏–Ω—É—Ç—ã"
        ];

        function addThesis() {
            currentThesisCount++;
            let optionsHtml = `<option value="" disabled selected>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>`;
            timeOptions.forEach(opt => {
                optionsHtml += `<option value="${opt}">${opt}</option>`;
            });
            optionsHtml += `<option value="custom">–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç...</option>`;

            const html = `
            <div class="thesis-block" id="thesis_block_${currentThesisCount}">
                <div class="thesis-header">
                    <div class="thesis-title">
                        <div id="thesis_${currentThesisCount}_name" class="thesis-name-input" contenteditable="true" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∑–∏—Å–∞..."></div>
                        <span class="info-icon" data-tooltip="${thesisTooltipText}">?</span>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="thesis_${currentThesisCount}_time" style="width: 160px;" onchange="handleCustomSelect(this)">
                            ${optionsHtml}
                        </select>
                        <div class="menu-container">
                            <button type="button" class="menu-dots" onclick="toggleMenu(${currentThesisCount})">‚ãÆ</button>
                            <div id="menu_${currentThesisCount}" class="menu-content">
                                <div class="menu-item">
                                    <label class="toggle-container" onclick="event.stopPropagation()">
                                        <span class="toggle-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</span>
                                        <div class="toggle-switch">
                                            <input type="checkbox" id="toggle_thesis_${currentThesisCount}"
                                                onchange="toggleComment('thesis_${currentThesisCount}', this.checked)">
                                            <span class="slider"></span>
                                        </div>
                                    </label>
                                </div>
                                <button type="button" class="btn-delete" onclick="removeThesis(${currentThesisCount})">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 14px; height: 14px;"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                    –£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid-info wide" id="grid_thesis_${currentThesisCount}">
                    <div class="form-group">
                        <label>–¢–µ–∑–∏—Å –∞–≤—Ç–æ—Ä–∞</label>
                        <div id="thesis_${currentThesisCount}_author" class="rich-textarea" contenteditable="true"></div>
                    </div>
                    <div class="form-group comment-group" id="group_thesis_${currentThesisCount}_comment">
                        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                        <div id="thesis_${currentThesisCount}_producer" class="rich-textarea" contenteditable="true"></div>
                    </div>
                </div>
            </div>
        `;
            container.insertAdjacentHTML('beforeend', html);

            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω—É–º–µ—Ä–∞—Ü–∏—é
            renumberTheses();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–≤—Ç–æ-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –Ω–æ–≤—ã—Ö textarea
            const newBlock = document.getElementById(`thesis_block_${currentThesisCount}`);
            newBlock.querySelectorAll('textarea').forEach(autoExpand);
        }

        function renumberTheses() {
            const inputs = container.querySelectorAll('.thesis-name-input');
            inputs.forEach((input, index) => {
                const newDefaultName = `–¢–µ–∑–∏—Å ${index + 1}`;
                const currentText = input.innerText.trim();
                // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ –∏–ª–∏ –≤ –Ω–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ "–¢–µ–∑–∏—Å ...", –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
                if (!currentText || /^–¢–µ–∑–∏—Å \d+$/.test(currentText)) {
                    input.innerText = newDefaultName;
                }
            });
        }

        function removeThesis(id) {
            document.getElementById('modalText').textContent = '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–µ–∑–∏—Å?';
            openModal('confirmModal');
            document.getElementById('confirmBtn').onclick = () => {
                const block = document.getElementById(`thesis_block_${id}`);
                if (block) {
                    block.remove();
                    renumberTheses();
                }
                closeModal('confirmModal');
                showToast('–¢–µ–∑–∏—Å —É–¥–∞–ª–µ–Ω', 'success');
            };
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–µ 3 —Ç–µ–∑–∏—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        window.addEventListener('load', () => {
            for (let i = 0; i < 3; i++) addThesis();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö textarea
        document.addEventListener('input', function (event) {
            if (event.target.tagName.toLowerCase() === 'textarea') {
                autoExpand(event.target);
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∞ –¥–ª—è rich-textarea, —Ç–∞–∫ –∫–∞–∫ div —Ä–∞—Å—Ç–µ—Ç —Å–∞–º

        // –õ–æ–≥–∏–∫–∞ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        function saveData() {
            const data = {
                theses: []
            };

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏–Ω–ø—É—Ç—ã –∏ —Å–µ–ª–µ–∫—Ç—ã (–∫—Ä–æ–º–µ —Ç–µ—Ö, —á—Ç–æ —Å—Ç–∞–ª–∏ div-–∞–º–∏)
            document.querySelectorAll('input:not(.thesis-name-input), select').forEach(el => {
                if (el.id && el.id !== 'title' && el.type !== 'file') {
                    data[el.id] = el.value;
                }
            });

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const mainTitle = document.getElementById('title');
            if (mainTitle) data['title'] = mainTitle.innerText;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º rich-—Ç–µ–∫—Å—Ç (–ò–Ω—Ç—Ä–æ, –û—É—Ç—Ä–æ, –ü—Ä–µ–≤—å—é –∏ —Ç.–¥.)
            document.querySelectorAll('.rich-textarea').forEach(el => {
                if (el.id && !el.id.startsWith('thesis_')) {
                    data[el.id] = el.innerHTML;
                }
            });

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–∑–∏—Å—ã
            document.querySelectorAll('.thesis-block').forEach(block => {
                const id = block.id.replace('thesis_block_', '');
                data.theses.push({
                    name: document.getElementById(`thesis_${id}_name`).innerText,
                    time: document.getElementById(`thesis_${id}_time`).value,
                    author: document.getElementById(`thesis_${id}_author`).innerHTML,
                    producer: document.getElementById(`thesis_${id}_producer`).innerHTML
                });
            });

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–æ–≥–≥–ª–æ–≤
            document.querySelectorAll('input[id^="toggle_"]').forEach(el => {
                data[el.id] = el.checked;
            });

            const titleEl = document.getElementById('title');
            const title = (titleEl.innerText || titleEl.textContent || '').trim() || '–ü–ª–∞–Ω';
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `${title}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // –õ–æ–≥–∏–∫–∞ –ó–∞–≥—Ä—É–∑–∫–∏
        function loadData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);

                    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–µ–∑–∏—Å—ã
                    container.innerHTML = '';
                    currentThesisCount = 0;

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
                    for (const key in data) {
                        if (key !== 'theses') {
                            const el = document.getElementById(key);
                            if (el) {
                                if (el.classList.contains('rich-textarea') || el.id === 'title' || el.classList.contains('thesis-name-input')) {
                                    if (el.id === 'title' || el.classList.contains('thesis-name-input')) {
                                        el.innerText = data[key];
                                    } else {
                                        el.innerHTML = data[key];
                                    }
                                } else {
                                    el.value = data[key];
                                }
                                if (el.tagName.toLowerCase() === 'select') updateSelectStyle(el);
                                // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –æ–±–ª–æ–∂–∫–∏
                                if (key === 'coverUrl' && data[key]) {
                                    document.getElementById('coverPreview').src = data[key];
                                }
                            }
                        }
                    }

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∑–∏—Å—ã
                    if (data.theses) {
                        data.theses.forEach(t => {
                            addThesis();
                            const id = currentThesisCount;

                            const timeEl = document.getElementById(`thesis_${id}_time`);
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ, –µ—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ
                            if (!Array.from(timeEl.options).some(opt => opt.value === t.time)) {
                                const newOpt = document.createElement('option');
                                newOpt.value = t.time;
                                newOpt.text = t.time;
                                timeEl.add(newOpt, timeEl.options[timeEl.options.length - 1]);
                            }

                            timeEl.value = t.time;
                            updateSelectStyle(timeEl);
                            document.getElementById(`thesis_${id}_name`).innerText = t.name || '';
                            document.getElementById(`thesis_${id}_author`).innerHTML = t.author;
                            document.getElementById(`thesis_${id}_producer`).innerHTML = t.producer;

                            // –í–∫–ª—é—á–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã –∏–ª–∏ –µ—Å–ª–∏ –ø–æ–ª–µ –Ω–µ –ø—É—Å—Ç–æ–µ
                            const toggleId = `toggle_thesis_${id}`;
                            const shouldToggle = data[toggleId] === true || (t.producer && t.producer.trim() !== '' && t.producer !== '<br>');
                            const toggle = document.getElementById(toggleId);
                            if (toggle) {
                                toggle.checked = shouldToggle;
                                toggleComment(`thesis_${id}`, shouldToggle);
                            }
                        });
                    }

                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≥–≥–ª–æ–≤ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ–∫—Ü–∏–π (–∏–Ω—Ç—Ä–æ / –æ—É—Ç—Ä–æ)
                    ['intro', 'outro'].forEach(section => {
                        const toggleId = `toggle_${section}`;
                        const commentId = `${section}_comment`;
                        const commentEl = document.getElementById(commentId);
                        const shouldToggle = data[toggleId] === true || (commentEl && commentEl.innerHTML.trim() !== '' && commentEl.innerHTML !== '<br>');
                        const toggle = document.getElementById(toggleId);
                        if (toggle) {
                            toggle.checked = shouldToggle;
                            toggleComment(section, shouldToggle);
                        }
                    });

                    showToast('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
                } catch (err) {
                    console.error(err);
                    showToast('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
                }
                input.value = '';
            };
            reader.readAsText(file);
        }
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∏–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
        function updateSelectStyle(select) {
            if (select.value && select.value !== "" && select.value !== "custom") {
                select.classList.add('filled');
            } else {
                select.classList.remove('filled');
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –≤—Å–µ—Ö select
        document.addEventListener('change', (e) => {
            if (e.target.tagName === 'SELECT') {
                updateSelectStyle(e.target);
                if (e.target.onchange) e.target.onchange(); // –î–ª—è –≤—ã–∑–æ–≤–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü
        window.addEventListener('load', () => {
            document.querySelectorAll('select').forEach(updateSelectStyle);
        });

        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ (—á—Ç–æ–±—ã –Ω–µ —Ç—è–Ω—É—Ç—å —Å—Ç–∏–ª–∏ –∏–∑–≤–Ω–µ, –Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∂–∏—Ä–Ω—ã–π/–∫—É—Ä—Å–∏–≤)
        document.addEventListener('paste', (e) => {
            if (e.target.classList.contains('rich-textarea')) {
                e.preventDefault();
                const text = e.clipboardData.getData('text/plain');
                document.execCommand('insertText', false, text);
            }
        });
    </script>

</body>

</html>