<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Конвертер времени</title>
<link rel="icon" type="image/png" href="exchange.png">
<link rel="apple-touch-icon" href="exchange2.png">

<link rel="stylesheet" href="theme.css">

<style>
  /* === ЛОКАЛЬНЫЕ СТИЛИ (Специфика конвертера времени) === */
  
  /* Переопределяем некоторые переменные */
  :root {
    --input-bg: transparent;
    --btn-hover: var(--hover-bg);
  }

  body.dark {
    --input-bg: transparent;
  }

  .wrap { max-width: 490px; margin: 0 auto; padding: 22px 14px 28px; }
  
  /* ШАПКА */
  .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  
  h1 { font-size:1.25rem; margin:0; color: var(--text); }

  .topbar-controls {
    display: flex;
    gap: 8px;
  }
  
  .card { display:flex; flex-direction:column; gap:5px; }
  
  .row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    box-shadow: 0 1px 2px rgba(0,0,0,.03);
    padding: 10px 12px;
    gap: 10px;
    transition: border-color 0.2s, background 0.3s;
  }
  
  .row:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(122,162,255,.1);
  }

  .code {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 620; 
    font-size: 0.95rem; 
    width: 140px;
    color: var(--text);
  }
  
  .icon {
    width: 30px; 
    height: 30px; 
    display: inline-block; 
    vertical-align: middle; 
    object-fit: contain;
  }
  
  .amount { flex-grow: 1; }
  
  .amount input {
    width: 100%;
    max-width:50vw;
    text-align: right;
    font-size: 1.15rem !important;
    padding: 6px 0;
    border: none;
    background: var(--input-bg);
    color: var(--text);
  }
  
  .amount input:focus { outline: none; }
  .amount input::placeholder { color: var(--text-secondary); }

  /* КНОПКИ */
  button {
    background: var(--card-bg);
    border: 1px solid var(--border);
    color: var(--text);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  button:hover { background: var(--hover-bg); }
  button:active { transform: scale(0.95); }

  /* Кнопка Очистить */
  button#clearBtn {
    padding: 6px 12px;
    font-size: 0.95rem;
  }

  /* TOOLTIP (Глобальные стили в theme.css, но id нужен) */
  #customTooltip {
    position: fixed; background: var(--tooltip-bg); color: var(--tooltip-text); padding: 6px 12px; border-radius: 6px;
    font-size: 0.8rem; pointer-events: none; opacity: 0; transform: translateY(5px); transition: opacity 0.2s, transform 0.2s;
    z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); white-space: nowrap; font-weight: 500;
  }
  #customTooltip.visible { opacity: 1; transform: translateY(0); }

</style>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-384FKZ1NQP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-384FKZ1NQP');
</script>
</head>
<body>

<script src="theme-loader.js"></script>

<div id="customTooltip"></div>

<div id="header-container"></div>

<div class="wrap">

  <div class="topbar">
    <h1>Конвертер времени</h1>
    <div class="topbar-controls">
        <button id="clearBtn" title="Очистить поля">Очистить</button>
        </div>
  </div>

  <div class="card" id="fx"></div>

</div>

<script>
// === КОНСТАНТЫ ===
const BASE_YEAR_DAYS = 365.2425;
const MS_IN_SEC = 1000;
const MS_IN_MIN = 60 * MS_IN_SEC;
const MS_IN_HOUR = 60 * MS_IN_MIN;
const MS_IN_DAY = 24 * MS_IN_HOUR;
const MS_IN_WEEK = 7 * MS_IN_DAY;
const MS_IN_YEAR = BASE_YEAR_DAYS * MS_IN_DAY;
const MS_IN_MONTH = MS_IN_YEAR / 12;

const UNITS = [
  { code: 'MS', name: 'М.Секунды', factor: 1, precision: 0, static: 'https://em-content.zobj.net/source/microsoft-3D-fluent/433/diamond-with-a-dot_1f4a0.png', animated: 'https://em-content.zobj.net/source/microsoft-teams/400/diamond-with-a-dot_1f4a0.png' },
  { code: 'S', name: 'Секунды', factor: MS_IN_SEC, precision: 3, static: 'https://em-content.zobj.net/source/microsoft-3D-fluent/433/stopwatch_23f1-fe0f.png', animated: 'https://em-content.zobj.net/source/microsoft-teams/400/stopwatch_23f1-fe0f.png' },
  { code: 'MIN', name: 'Минуты', factor: MS_IN_MIN, precision: 4, static: 'https://em-content.zobj.net/source/microsoft-3D-fluent/433/one-oclock_1f550.png', animated: 'https://em-content.zobj.net/source/microsoft-teams/400/one-oclock_1f550.png' },
  { code: 'H', name: 'Часы', factor: MS_IN_HOUR, precision: 5, static: 'https://em-content.zobj.net/source/microsoft-3D-fluent/433/three-oclock_1f552.png', animated: 'https://em-content.zobj.net/source/microsoft-teams/400/three-oclock_1f552.png' },
  { code: 'D', name: 'Дни', factor: MS_IN_DAY, precision: 6, static: 'https://em-content.zobj.net/source/microsoft-3D-fluent/433/sun_2600-fe0f.png', animated: 'https://em-content.zobj.net/source/microsoft-teams/400/sun_2600-fe0f.png' },
  { code: 'WK', name: 'Недели', factor: MS_IN_WEEK, precision: 6, static: 'https://em-content.zobj.net/source/microsoft-3D-fluent/433/spiral-calendar_1f5d3-fe0f.png', animated: 'https://em-content.zobj.net/source/microsoft-teams/400/spiral-calendar_1f5d3-fe0f.png' },
  { code: 'MO', name: 'Месяцы', factor: MS_IN_MONTH, precision: 7, static: 'https://em-content.zobj.net/source/microsoft-3D-fluent/433/crescent-moon_1f319.png', animated: 'https://em-content.zobj.net/source/microsoft-teams/400/crescent-moon_1f319.png' },
  { code: 'YR', name: 'Годы', factor: MS_IN_YEAR, precision: 8, static: 'https://em-content.zobj.net/source/microsoft-3D-fluent/433/rocket_1f680.png', animated: 'https://em-content.zobj.net/source/microsoft-teams/400/rocket_1f680.png' }
];

const container = document.getElementById('fx');
const clearBtn = document.getElementById('clearBtn');

// === ФУНКЦИИ ===
function parseRaw(str) {
    if(!str) return 0;
    return parseFloat(str.replace(/\s/g, '').replace(',', '.')) || 0;
}

function formatPretty(num, maxDecimals) {
    if (num === 0) return '';
    if (Math.abs(num) < 1e-10) return '0';
    return num.toLocaleString('ru-RU', {
        maximumFractionDigits: maxDecimals,
        minimumFractionDigits: 0
    });
}

function formatInputLive(input) {
    let raw = input.value;
    if (!raw) return;

    const cursor = input.selectionStart;
    let meaningfulCharsBeforeCursor = 0;
    for (let i = 0; i < cursor; i++) {
        if (/[\d.,]/.test(raw[i])) meaningfulCharsBeforeCursor++;
    }

    let clean = raw.replace(/\s/g, '').replace('.', ','); 
    
    let parts = clean.split(',');
    let integerPart = parts[0];
    let decimalPart = parts.length > 1 ? parts.slice(1).join('') : null;

    let formattedInt = '';
    if (integerPart !== '') {
        if (!isNaN(parseInt(integerPart))) {
             formattedInt = parseInt(integerPart).toLocaleString('ru-RU');
        } else {
             formattedInt = integerPart;
        }
    }

    let newVal = formattedInt;
    if (decimalPart !== null) {
        newVal += ',' + decimalPart;
    } else if (clean.includes(',')) {
        newVal += ',';
    }

    if (input.value !== newVal) {
        input.value = newVal;
        let newCursor = 0;
        let count = 0;
        for (let i = 0; i < newVal.length; i++) {
            if (count === meaningfulCharsBeforeCursor) break;
            if (/[\d.,]/.test(newVal[i])) {
                count++;
            }
            newCursor++;
        }
        input.setSelectionRange(newCursor, newCursor);
    }
}

let animTimeout = null;
function triggerIconsAnimation() {
    document.querySelectorAll('.icon').forEach(img => {
        const alt = img.dataset.animated;
        if(alt && img.src !== alt) img.src = alt;
    });
    if (animTimeout) clearTimeout(animTimeout);
    animTimeout = setTimeout(() => {
        document.querySelectorAll('.icon').forEach(img => img.src = img.dataset.static);
    }, 3000);
}

// === РЕНДЕРИНГ ===
function render() {
    container.innerHTML = '';
    UNITS.forEach(u => {
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
            <div class="code">
                <img class="icon" src="${u.static}" data-static="${u.static}" data-animated="${u.animated}" alt="">
                <span>${u.name}</span>
            </div>
            <div class="amount">
                <input type="text" inputmode="decimal" data-code="${u.code}" placeholder="0">
            </div>
        `;
        container.appendChild(row);
    });
    setupEvents();
}

function setupEvents() {
    const inputs = container.querySelectorAll('input');

    inputs.forEach(input => {
        input.addEventListener('input', (e) => {
            const el = e.target;
            const code = el.dataset.code;
            
            triggerIconsAnimation();
            formatInputLive(el);
            
            const rawVal = el.value;
            if (rawVal.trim() === '') {
                inputs.forEach(i => { if(i !== el) i.value = ''; });
                return;
            }

            const val = parseRaw(rawVal);
            const unitData = UNITS.find(u => u.code === code);
            const baseMs = val * unitData.factor;

            inputs.forEach(otherInput => {
                if (otherInput === el) return;
                const otherCode = otherInput.dataset.code;
                const otherUnit = UNITS.find(u => u.code === otherCode);
                const convertedVal = baseMs / otherUnit.factor;
                otherInput.value = formatPretty(convertedVal, otherUnit.precision);
            });
        });
    });
}

clearBtn.onclick = () => {
    container.querySelectorAll('input').forEach(i => i.value = '');
};

// ==== TOOLTIPS (ПОДСКАЗКИ) ====
const tooltipEl = document.getElementById('customTooltip');

function showTooltip(el) {
    const text = el.getAttribute('data-tip');
    if (!text) return;

    const rect = el.getBoundingClientRect();
    tooltipEl.textContent = text;
    tooltipEl.classList.add('visible');

    let top = rect.bottom + 8;
    let left = rect.left + (rect.width / 2) - (tooltipEl.offsetWidth / 2);

    if (left < 10) left = 10;
    if (left + tooltipEl.offsetWidth > window.innerWidth) {
        left = window.innerWidth - tooltipEl.offsetWidth - 10;
    }

    tooltipEl.style.top = `${top}px`;
    tooltipEl.style.left = `${left}px`;
}

document.querySelectorAll('[data-tip]').forEach(el => {
    el.addEventListener('mouseenter', () => showTooltip(el));
    el.addEventListener('mouseleave', () => tooltipEl.classList.remove('visible'));
    el.addEventListener('click', () => tooltipEl.classList.remove('visible'));
});

render();
</script>
  <link rel="stylesheet" href="footer.css">
<div id="footer"></div>
<script>
fetch('footer.html')
  .then(r => r.text())
  .then(html => document.getElementById('footer').innerHTML = html);
</script>

<link rel="stylesheet" href="auth-widget.css">
<script type="module" src="nav-widget.js"></script> 
<script type="module" src="auth-widget.js"></script>
<script type="module" src="header.js"></script>
</body>
</html>