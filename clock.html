<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Мировые часы</title>
<link rel="icon" type="image/png" href="clock.png">
<link rel="apple-touch-icon" href="clock2.png">
<style>
  /* === ЦВЕТОВЫЕ ПЕРЕМЕННЫЕ === */
  :root {
    --bg: #f4f6fb;
    --text: #0b0d12;
    --card-bg: #ffffff;
    --border: #e6e9f2;
    --input-bg: #ffffff;
    --btn-hover: #f0f2f7;
    --accent: #7aa2ff;
    
    --tooltip-bg: #2a2c33;
    --tooltip-text: #ffffff;
    
    --gray: #999;
    /* --danger больше не нужен для крестиков, но оставим на всякий случай */
    --danger: #ff5757; 
  }

  body.dark {
    --bg: #0f1115;
    --text: #f3f3f3;
    --card-bg: #1a1d22;
    --border: #292c33;
    --input-bg: #1a1d22;
    --btn-hover: #252830;
    --accent: #5b8af0;
    
    --tooltip-bg: #e6e9f2;
    --tooltip-text: #0f1115;
    
    --gray: #6b6b6b;
  }

  /* --- ИСПРАВЛЕНИЕ ИКОНОК В ТЕМНОЙ ТЕМЕ --- */
  /* Инвертируем только черно-белые PNG иконки. SVG и цветные не трогаем. */
  body.dark .theme-icon,
  body.dark #shareBtn img,
  body.dark #copyLink img {
      filter: invert(1) brightness(1.3);
  }
  
  /* Темная тема для шаринга */
  body.dark #sharePopup { background: var(--card-bg); border-color: var(--border); color: var(--text); }
  /* Цвет фона кнопок в темной теме */
  body.dark #copyLink { background: var(--btn-hover) !important; color: var(--text) !important; }
  body.dark #tgShare { background: rgba(42, 171, 238, 0.2) !important; color: var(--text) !important; }
  body.dark #waShare { background: rgba(37, 211, 102, 0.2) !important; color: var(--text) !important; }
  body.dark #fbShare { background: rgba(24, 119, 242, 0.2) !important; color: var(--text) !important; }

  *{box-sizing:border-box}
  
  body {
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    margin: 0;
    background: var(--bg);
    color: var(--text);
    transition: background 0.3s ease, color 0.3s ease;
  }

  .wrap {max-width:500px; margin:0 auto; padding:22px 14px 28px}
  
  /* ШАПКА */
  .topbar {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;
  }
  h1 { font-size:1.25rem; margin:0; }
  
  .topbar-controls { display: flex; gap: 8px; align-items: center; }

  /* КНОПКИ В ШАПКЕ */
  button.header-btn {
    background: var(--card-bg); 
    border: 1px solid var(--border); 
    border-radius: 8px; 
    color: var(--text);
    cursor: pointer; 
    transition: all 0.2s ease;
    display: flex; align-items: center; justify-content: center;
  } 
  button.header-btn:hover { background: var(--btn-hover); }

  #themeToggle { padding: 6px 10px;}
  #themeToggle img { width: 11px; height: 11px; display: block; pointer-events: none; }

  #shareBtn {
      font-size: 0.9rem;
      padding: 4px 10px; 
      gap: 6px;
  }
  #shareBtn img { width: 11px; height: 11px; display: block; }

  /* КАРТОЧКИ ГОРОДОВ */
  .card {display:flex; flex-direction:column; gap:4px}
  
  .row {
      display:flex; align-items:center; justify-content:space-between;
      background: var(--card-bg); 
      border: 1px solid var(--border); 
      border-radius: 12px; 
      box-shadow: 0 1px 2px rgba(0,0,0,.03); 
      padding: 10px 12px;
      transition: background 0.3s, border-color 0.3s;
      position: relative;
  }
  
  .code {display:flex; align-items:center; gap:8px; font-weight:700; color: var(--text);}
  .flag {border-radius:4px; width:24px; height:18px; vertical-align:middle}
  
  .time {
      font-size:1.3rem; 
      font-variant-numeric:tabular-nums; 
      display:flex; align-items:flex-end; gap:4px;
      text-align: right;
      transition: padding-right 0.2s ease;
      color: var(--text);
  }
  .seconds {font-size:.8rem; color: var(--gray); position:relative; bottom:2px}
  
  .edit-mode .time { padding-right: 28px; }

  /* --- ИСПРАВЛЕНИЕ КРЕСТИКА УДАЛЕНИЯ --- */
  .delBtn {
    position: absolute; right: 5px; top: 50%; transform: translateY(-50%);
    background: none; border: none; 
    font-size: 1.1rem; 
    color: var(--gray); /* Изначально серый */
    cursor: pointer; opacity: 0.7; display: none;
    z-index: 5;
    transition: color 0.2s, opacity 0.2s;
  }
  /* При наведении просто становится ярче (цветом текста) */
  .delBtn:hover { opacity: 1; color: var(--text); }
  
  body.edit-mode .delBtn { display: block; }

  /* НИЖНИЕ КНОПКИ (Action Styles) */
  .center-controls {
      display:flex; justify-content:center; width: 100%; margin-top:18px;
  }

  .action-btn {
      padding: 10px; 
      background: var(--card-bg); 
      border: 1px solid var(--border); 
      border-radius: 12px; 
      color: var(--accent);
      font-size: 15px; 
      font-weight: 600;
      display: flex; align-items: center; justify-content: center; 
      gap: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
  }
  .action-btn:hover { border-color: var(--accent); background: var(--btn-hover); }
  /* SVG наследует цвет текста кнопки (акцентный) */
  .action-btn svg { width: 18px; height: 18px; fill: currentColor; }
  
  #editBtn { width: 50%; min-width: 200px; }

  /* ГРУППА РЕДАКТИРОВАНИЯ */
  .edit-group {
      display: flex; gap: 10px; width: 100%;
      align-items: stretch;
  }
  
  .input-wrapper {
      flex-grow: 1; 
      position: relative;
  }
  
  input[type="text"] {
      width: 100%; height: 100%;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--input-bg);
      font-size: 16px;
      color: var(--text);
      transition: border-color 0.2s;
  }
  input[type="text"]:focus { outline: none; border-color: var(--accent); }

  #saveBtn {
      width: auto; 
      padding-left: 15px;
      padding-right: 15px;
      white-space: nowrap;
      flex-shrink: 0; 
  }

  /* ПОДСКАЗКИ ПОИСКА */
  .suggest {
    position: absolute; left: 0; bottom: calc(100% + 6px);
    width: 100%; 
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    box-shadow: 0 -6px 18px rgba(0, 0, 0, 0.12);
    overflow: hidden; z-index: 10;
    display: none; max-height: 300px; overflow-y: auto;
  }
  .suggest.visible { display:block; }
  
  .opt { display:flex; align-items:center; gap:8px; padding:8px 10px; border-bottom:1px solid var(--border); cursor:pointer; color: var(--text); }
  .opt:last-child { border-bottom:0; }
  .opt:hover { background: var(--btn-hover); }
  .opt .country { font-size:.85rem; opacity:.7; }

  /* SHARE POPUP */
  #sharePopup {
    position:absolute; display:none; background:#fff; border:1px solid #ddd;
    padding:10px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.15);
    flex-direction:column; gap:8px; z-index:100; width:190px;
    animation:fadeIn .2s ease; color:#222;
  }
  @keyframes fadeIn{ from{opacity:0;transform:translateY(-4px);} to{opacity:1;transform:translateY(0);} }

  /* TOOLTIP */
  #customTooltip {
    position: fixed; background: var(--tooltip-bg); color: var(--tooltip-text); padding: 6px 12px; border-radius: 6px;
    font-size: 0.8rem; pointer-events: none; opacity: 0; transform: translateY(5px); transition: opacity 0.2s, transform 0.2s;
    z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); white-space: nowrap; font-weight: 500;
  }
  #customTooltip.visible { opacity: 1; transform: translateY(0); }

</style>
      <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-384FKZ1NQP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-384FKZ1NQP');
</script>
</head>
<body>

<div id="customTooltip"></div>

<div class="wrap">
  <div class="topbar">
      <h1>Мировые часы</h1>
      <div class="topbar-controls">
          <button id="themeToggle" class="header-btn" data-tip="Сменить тему">
              <img class="theme-icon" src="https://cdn-icons-png.flaticon.com/128/4489/4489231.png" alt="Theme">
          </button>
          <button id="shareBtn" class="header-btn" data-tip="Поделиться списком">
              <img src="https://cdn-icons-png.flaticon.com/512/1828/1828954.png" alt="">
              Поделиться
          </button>
      </div>
  </div>

  <div class="card" id="clocks"></div>

  <div class="center-controls" id="mainControls">
    <button id="editBtn" class="action-btn">
        <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
        Редактировать
    </button>
  </div>

  <div class="center-controls" id="editControls" style="display:none;">
      <div class="edit-group">
          <div class="input-wrapper">
             <input id="search" type="text" placeholder="Добавить город или страну..." autocomplete="off" autocorrect="off" spellcheck="false">
             <div id="suggest" class="suggest" role="listbox"></div>
          </div>
          <button id="saveBtn" class="action-btn">
              <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
              Сохранить
          </button>
      </div>
  </div>

  <div id="sharePopup">
    <button id="copyLink" style="display:flex;align-items:center;gap:8px;padding:8px;border:none;background:#f5f5f5;border-radius:8px;cursor:pointer;color:#222;width:100%">
      <img src="https://cdn-icons-png.flaticon.com/512/7640/7640062.png" width="18" height="18" alt="">
      Ссылка
    </button>
    <a id="tgShare" target="_blank" style="display:flex;align-items:center;gap:8px;text-decoration:none;padding:8px;border-radius:8px;background:#e3f2fd;color:#222;">
      <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" width="18" height="18" alt="">
      Telegram
    </a>
    <a id="waShare" target="_blank" style="display:flex;align-items:center;gap:8px;text-decoration:none;padding:8px;border-radius:8px;background:#e8f5e9;color:#222;">
      <img src="https://cdn-icons-png.flaticon.com/512/2111/2111728.png" width="18" height="18" alt="">
      WhatsApp
    </a>
    <a id="fbShare" target="_blank" style="display:flex;align-items:center;gap:8px;text-decoration:none;padding:8px;border-radius:8px;background:#e3f2fd;color:#222;">
      <img src="https://cdn-icons-png.flaticon.com/512/733/733547.png" width="18" height="18" alt="">
      Facebook
    </a>
  </div>
</div>

<script>
  const toId = tz => 't-' + tz.replace(/\//g,'-');
  const flagURL = c => c==='xx'?`data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='18'><rect width='24' height='18' rx='3' ry='3' fill='#e9edf5'/></svg>`:`https://flagcdn.com/w40/${c}.png`;

  const params = new URLSearchParams(location.search);
  let cities = params.get('tz')
    ? params.get('tz').split(',').map(s=>{
        const [name,tz,flag]=decodeURIComponent(s).split('|');
        return {name,tz,flag:flag||'xx'};
      })
    : [
        {name:'Прага',        tz:'Europe/Prague',        flag:'cz'},
        {name:'Киев',         tz:'Europe/Kiev',          flag:'ua'},
        {name:'Москва',       tz:'Europe/Moscow',        flag:'ru'},
        {name:'Лондон',       tz:'Europe/London',        flag:'gb'},
        {name:'Нью-Йорк',     tz:'America/New_York',     flag:'us'},
        {name:'Лос-Анджелес', tz:'America/Los_Angeles',  flag:'us'},
        {name:'Токио',        tz:'Asia/Tokyo',           flag:'jp'},
        {name:'Сидней',       tz:'Australia/Sydney',     flag:'au'}
      ];

  const box=document.getElementById('clocks');
  const input=document.getElementById('search');
  const sugg=document.getElementById('suggest');
  const mainControls=document.getElementById('mainControls');
  const editControls=document.getElementById('editControls');

  function render() {
    box.innerHTML = '';
    const now = new Date();

    for (const { name, tz, flag } of cities) {
      const id = toId(tz);
      const row = document.createElement('div');
      row.className = 'row';

      row.innerHTML = `
        <div class="code">
          <img class="flag" src="${flagURL(flag)}" alt="${name}">
          <span>${name}</span>
        </div>
        <div class="time" id="${id}"></div>
        <button class="delBtn" data-tip="Удалить">✕</button>
      `;

      const delBtn = row.querySelector('.delBtn');
      delBtn.onclick = () => {
        cities = cities.filter(c => c.tz !== tz);
        render();
        updateURL();
      };

      box.appendChild(row);
      setTime(id, tz, now);
    }
  }

  function setTime(id,tz,now=new Date()){
    const el=document.getElementById(id);
    try{
      const p=new Intl.DateTimeFormat('ru-RU',{timeZone:tz,hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false}).formatToParts(now);
      el.innerHTML=`${p.find(x=>x.type==='hour').value}:${p.find(x=>x.type==='minute').value} <span class='seconds'>${p.find(x=>x.type==='second').value}</span>`;
    }catch{if(el)el.innerHTML='--:-- <span class="seconds">--</span>';}
  }

  function tick(){
    const now=new Date();
    for(const c of cities)setTime(toId(c.tz),c.tz,now);
  }

  function buildQS(){
    const parts=cities.map(c=>encodeURIComponent(`${c.name}|${c.tz}|${c.flag}`));
    return `?tz=${parts.join(',')}`;
  }

  function updateURL(){history.replaceState(null,'',location.pathname+buildQS());}

  document.getElementById('editBtn').onclick = () => {
    mainControls.style.display = 'none';
    editControls.style.display = 'block'; 
    document.body.classList.add('edit-mode');
  };

  document.getElementById('saveBtn').onclick = () => {
    editControls.style.display = 'none';
    mainControls.style.display = 'flex';
    document.body.classList.remove('edit-mode');
    updateURL();
  };

  const CITIES_DB=[
    // --- Европа ---
    {name:'Прага', country:'Чехия', tz:'Europe/Prague', flag:'cz'},
    {name:'Варшава', country:'Польша', tz:'Europe/Warsaw', flag:'pl'},
    {name:'Берлин', country:'Германия', tz:'Europe/Berlin', flag:'de'},
    {name:'Гамбург', country:'Германия', tz:'Europe/Berlin', flag:'de'},
    {name:'Мюнхен', country:'Германия', tz:'Europe/Berlin', flag:'de'},
    {name:'Париж', country:'Франция', tz:'Europe/Paris', flag:'fr'},
    {name:'Рим', country:'Италия', tz:'Europe/Rome', flag:'it'},
    {name:'Милан', country:'Италия', tz:'Europe/Rome', flag:'it'},
    {name:'Мадрид', country:'Испания', tz:'Europe/Madrid', flag:'es'},
    {name:'Барселона', country:'Испания', tz:'Europe/Madrid', flag:'es'},
    {name:'Лиссабон', country:'Португалия', tz:'Europe/Lisbon', flag:'pt'},
    {name:'Лондон', country:'Великобритания', tz:'Europe/London', flag:'gb'},
    {name:'Дублин', country:'Ирландия', tz:'Europe/Dublin', flag:'ie'},
    {name:'Амстердам', country:'Нидерланды', tz:'Europe/Amsterdam', flag:'nl'},
    {name:'Брюссель', country:'Бельгия', tz:'Europe/Brussels', flag:'be'},
    {name:'Вена', country:'Австрия', tz:'Europe/Vienna', flag:'at'},
    {name:'Будапешт', country:'Венгрия', tz:'Europe/Budapest', flag:'hu'},
    {name:'Афины', country:'Греция', tz:'Europe/Athens', flag:'gr'},
    {name:'Киев', country:'Украина', tz:'Europe/Kiev', flag:'ua'},
    {name:'Львов', country:'Украина', tz:'Europe/Kiev', flag:'ua'},
    {name:'Одесса', country:'Украина', tz:'Europe/Kiev', flag:'ua'},
    {name:'Минск', country:'Беларусь', tz:'Europe/Minsk', flag:'by'},
    {name:'Осло', country:'Норвегия', tz:'Europe/Oslo', flag:'no'},
    {name:'Стокгольм', country:'Швеция', tz:'Europe/Stockholm', flag:'se'},
    {name:'Хельсинки', country:'Финляндия', tz:'Europe/Helsinki', flag:'fi'},
    {name:'Копенгаген', country:'Дания', tz:'Europe/Copenhagen', flag:'dk'},
    {name:'Рейкьявик', country:'Исландия', tz:'Atlantic/Reykjavik', flag:'is'},
    {name:'Цюрих', country:'Швейцария', tz:'Europe/Zurich', flag:'ch'},

    // --- РОССИЯ / СНГ ---
    {name:'Москва', country:'Россия', tz:'Europe/Moscow', flag:'ru'},
    {name:'Санкт-Петербург', country:'Россия', tz:'Europe/Moscow', flag:'ru'},
    {name:'Новосибирск', country:'Россия', tz:'Asia/Novosibirsk', flag:'ru'},
    {name:'Екатеринбург', country:'Россия', tz:'Asia/Yekaterinburg', flag:'ru'},
    {name:'Казань', country:'Россия', tz:'Europe/Moscow', flag:'ru'},
    {name:'Владивосток', country:'Россия', tz:'Asia/Vladivostok', flag:'ru'},
    {name:'Калининград', country:'Россия', tz:'Europe/Kaliningrad', flag:'ru'},
    {name:'Ереван', country:'Армения', tz:'Asia/Yerevan', flag:'am'},
    {name:'Баку', country:'Азербайджан', tz:'Asia/Baku', flag:'az'},
    {name:'Тбилиси', country:'Грузия', tz:'Asia/Tbilisi', flag:'ge'},
    {name:'Астана', country:'Казахстан', tz:'Asia/Almaty', flag:'kz'},
    {name:'Алматы', country:'Казахстан', tz:'Asia/Almaty', flag:'kz'},
    {name:'Ташкент', country:'Узбекистан', tz:'Asia/Tashkent', flag:'uz'},

    // --- Америка ---
    {name:'Нью-Йорк', country:'США', tz:'America/New_York', flag:'us'},
    {name:'Вашингтон', country:'США', tz:'America/New_York', flag:'us'},
    {name:'Чикаго', country:'США', tz:'America/Chicago', flag:'us'},
    {name:'Лос-Анджелес', country:'США', tz:'America/Los_Angeles', flag:'us'},
    {name:'Сан-Франциско', country:'США', tz:'America/Los_Angeles', flag:'us'},
    {name:'Майами', country:'США', tz:'America/New_York', flag:'us'},
    {name:'Торонто', country:'Канада', tz:'America/Toronto', flag:'ca'},
    {name:'Ванкувер', country:'Канада', tz:'America/Vancouver', flag:'ca'},
    {name:'Мехико', country:'Мексика', tz:'America/Mexico_City', flag:'mx'},
    {name:'Буэнос-Айрес', country:'Аргентина', tz:'America/Argentina/Buenos_Aires', flag:'ar'},
    {name:'Сан-Паулу', country:'Бразилия', tz:'America/Sao_Paulo', flag:'br'},

    // --- Азия ---
    {name:'Токио', country:'Япония', tz:'Asia/Tokyo', flag:'jp'},
    {name:'Сеул', country:'Южная Корея', tz:'Asia/Seoul', flag:'kr'},
    {name:'Пекин', country:'Китай', tz:'Asia/Shanghai', flag:'cn'},
    {name:'Шанхай', country:'Китай', tz:'Asia/Shanghai', flag:'cn'},
    {name:'Гонконг', country:'Гонконг', tz:'Asia/Hong_Kong', flag:'hk'},
    {name:'Сингапур', country:'Сингапур', tz:'Asia/Singapore', flag:'sg'},
    {name:'Бангкок', country:'Таиланд', tz:'Asia/Bangkok', flag:'th'},
    {name:'Дубай', country:'ОАЭ', tz:'Asia/Dubai', flag:'ae'},
    {name:'Стамбул', country:'Турция', tz:'Europe/Istanbul', flag:'tr'},
    {name:'Тель-Авив', country:'Израиль', tz:'Asia/Jerusalem', flag:'il'},
    
    // --- Австралия ---
    {name:'Сидней', country:'Австралия', tz:'Australia/Sydney', flag:'au'},
    {name:'Мельбурн', country:'Австралия', tz:'Australia/Melbourne', flag:'au'}
  ];

  function filterDB(q){
    q=q.toLowerCase();
    return CITIES_DB.filter(x=>x.name.toLowerCase().includes(q)||x.country.toLowerCase().includes(q)).slice(0,3);
  }

  function renderSuggest(items){
    sugg.innerHTML='';
    if(!items.length){sugg.classList.remove('visible');return;}
    for(const it of items){
      const el=document.createElement('div');
      el.className='opt';
      el.innerHTML=`<img class="flag" src="${flagURL(it.flag)}"><div><div>${it.name}</div><div class='country'>${it.country}</div></div>`;
      el.onclick=()=>{
        if(!cities.some(c=>c.tz===it.tz)){
          cities.push(it);
          render();
          updateURL();
        }
        input.value='';
        hideSuggest();
      };
      sugg.appendChild(el);
    }
    sugg.classList.add('visible');
  }

  function hideSuggest(){sugg.classList.remove('visible');}
  input.oninput=()=>renderSuggest(filterDB(input.value));
  input.onfocus=()=>renderSuggest(filterDB(input.value));
  document.addEventListener('click',e=>{if(!sugg.contains(e.target)&&e.target!==input)hideSuggest();});

  // --- SHARE LOGIC (ТОЛЬКО КЛИК) ---
  const shareBtn=document.getElementById('shareBtn');
  const popup=document.getElementById('sharePopup');
  const copyLink=document.getElementById('copyLink');
  const tg=document.getElementById('tgShare');
  const wa=document.getElementById('waShare');
  const fb=document.getElementById('fbShare');
  const tooltipEl = document.getElementById('customTooltip');

  async function showSharePopup() {
    tooltipEl.classList.remove('visible'); // Скрыть тултип при открытии

    let longUrl = window.location.href;
    let shortUrl = longUrl;
    try {
      const r = await fetch(`https://is.gd/create.php?format=json&url=${encodeURIComponent(longUrl)}`);
      const data = await r.json();
      if (data.shorturl) shortUrl = data.shorturl;
    } catch (e) { }

    tg.href = `https://t.me/share/url?url=${encodeURIComponent(shortUrl)}`;
    wa.href = `https://api.whatsapp.com/send?text=${encodeURIComponent(shortUrl)}`;
    fb.href = `https://www.facebook.com/share_channel/?type=reshare&link=${encodeURIComponent(shortUrl)}&app_id=87741124305&source_surface=external_reshare&display=popup`;

    copyLink.onclick = () => {
      navigator.clipboard.writeText(shortUrl);
      copyLink.innerHTML = `<img src="https://cdn-icons-png.flaticon.com/512/1442/1442912.png" width="18" height="18" alt="">Скопировано!`;
      setTimeout(() => {
        copyLink.innerHTML = `<img src="https://cdn-icons-png.flaticon.com/512/7640/7640062.png" width="18" height="18"> Ссылка`;
      }, 2000);
    };

    const rect = shareBtn.getBoundingClientRect();
    popup.style.left = (rect.left + rect.width/2 - 190/2) + "px"; 
    if(parseInt(popup.style.left) < 10) popup.style.left = '10px';
    if(parseInt(popup.style.left) + 190 > window.innerWidth) popup.style.left = (window.innerWidth - 200) + 'px';

    popup.style.top = rect.bottom + 8 + "px";
    popup.style.display = "flex";
  }

  // ОБРАБОТЧИК КЛИКА ПО КНОПКЕ ПОДЕЛИТЬСЯ (для всех устройств)
  shareBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (popup.style.display === 'flex') {
        popup.style.display = 'none';
    } else {
        showSharePopup();
    }
  });

  // Закрытие при клике вне
  document.addEventListener('click', (e) => {
    if (!popup.contains(e.target) && e.target !== shareBtn) popup.style.display = 'none';
  });

  // --- THEME & TOOLTIPS ---
  const savedTheme = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
  function applyTheme(theme) {
    if (theme === 'dark') document.body.classList.add('dark');
    else document.body.classList.remove('dark');
  }
  if (savedTheme) applyTheme(savedTheme);
  else applyTheme(prefersDark.matches ? 'dark' : 'light');
  document.getElementById('themeToggle').onclick = () => {
    const isDark = document.body.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  };

  function showTooltip(el) {
    if (!window.matchMedia('(hover: hover)').matches) return;
    if (popup.style.display === 'flex') return;

    const text = el.getAttribute('data-tip');
    if (!text) return;
    const rect = el.getBoundingClientRect();
    tooltipEl.textContent = text;
    tooltipEl.classList.add('visible');
    let top = rect.bottom + 8;
    let left = rect.left + (rect.width/2) - (tooltipEl.offsetWidth/2);
    if (left < 10) left = 10;
    if (left + tooltipEl.offsetWidth > window.innerWidth) left = window.innerWidth - tooltipEl.offsetWidth - 10;
    tooltipEl.style.top = `${top}px`;
    tooltipEl.style.left = `${left}px`;
  }

  document.body.addEventListener('mouseover', (e) => {
      const target = e.target.closest('[data-tip]');
      if (target) showTooltip(target);
  });
  document.body.addEventListener('mouseout', (e) => {
      const target = e.target.closest('[data-tip]');
      if (target) tooltipEl.classList.remove('visible');
  });
  document.body.addEventListener('click', (e) => {
      const target = e.target.closest('[data-tip]');
      if (target) tooltipEl.classList.remove('visible');
  });

  render();tick();setInterval(tick,1000);
</script>
<link rel="stylesheet" href="footer.css">
<div id="footer"></div>
<script>
fetch('footer.html')
  .then(r => r.text())
  .then(html => document.getElementById('footer').innerHTML = html);
</script>
</body>
</html>

