<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lofi –ü–ª–µ–µ—Ä</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéß</text></svg>">

<style>
/* === –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò === */
:root {
    --primary: #6200ee;
    --primary-dark: #5000ca;
    --bg-color: #f6f7fb;
    --border-color: #e6e9f2;
    --card-bg: #fff;
    --active-bg: #eef2ff;
    --disabled-color: #d1d5db;
}

*{box-sizing:border-box}
body{
    margin:0;
    font-family:system-ui,-apple-system,sans-serif;
    background:var(--bg-color);
    color:#0c0c0d;
}
.wrap{
    max-width:850px;
    margin:0 auto;
    padding:16px 14px 40px; 
}
h1{margin:0 0 20px;font-size:1.4rem;text-align:center;color:#202124;}

/* --- –ö–∞—Ä—Ç–æ—á–∫–∞ --- */
.card{
    background:var(--card-bg);
    border:1px solid var(--border-color);
    border-radius:12px;
    padding:16px; 
    box-shadow:0 1px 0 rgba(0,0,0,.03);
    min-height: 400px;
}

#player-container {
    display: flex;
    gap: 20px;
}

/* --- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–ü–ª–µ–π–ª–∏—Å—Ç) --- */
#playlist-sidebar {
    width: 40%;
    flex-shrink: 0;
    max-height: calc(100vh - 80px); 
    overflow-y: auto;
}
#playlist-sidebar h2 { font-size: 1rem; margin: 0 0 10px; }

.playlist-item {
    display: flex; gap: 10px; padding: 10px; margin-bottom: 6px;
    border-radius: 8px; cursor: pointer; transition: 0.2s;
    background: #fafbff; border: 1px solid transparent;
}
.playlist-item:hover { background: #f0f2f5; }
.playlist-item.active { background: var(--active-bg); border-color: var(--primary); }

.playlist-thumb {
    width: 60px; height: 34px; flex-shrink: 0;
    border-radius: 4px; overflow: hidden; border: 1px solid #eee;
}
.playlist-thumb img { width: 100%; height: 100%; object-fit: cover; }

.playlist-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
.playlist-title {
    font-size: 0.85rem; font-weight: 500; line-height: 1.3;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
}
.playlist-channel { font-size: 0.75rem; color: #666; margin-top: 2px; }

/* --- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–ü–ª–µ–µ—Ä) --- */
#main-player-area {
    width: 60%; flex-grow: 1;
    display: flex; flex-direction: column;
    align-items: center; text-align: center;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–ª–µ–µ—Ä–∞ (–û–±–µ—Ä—Ç–∫–∞) */
#visual-container {
    width: 100%;
    max-width: 480px;
    aspect-ratio: 16 / 9;
    margin-bottom: 14px;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    background: #000;
    transition: all 0.3s ease;
}

/* YouTube Iframe */
#youtube-iframe-wrap {
    width: 100%; height: 100%;
    position: absolute; top: 0; left: 0;
    z-index: 10;
}
#youtube-iframe-wrap iframe { width: 100%; height: 100%; border: none; }

/* –ö–∞—Ä—Ç–∏–Ω–∫–∞-–∑–∞–≥–ª—É—à–∫–∞ (–†–µ–∂–∏–º –û–±–ª–æ–∂–∫–∞) */
#cover-image {
    width: 100%; height: 100%;
    object-fit: cover;
    position: absolute; top: 0; left: 0;
    z-index: 20; /* –í—ã—à–µ –≤–∏–¥–µ–æ */
    display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    pointer-events: none; 
}

/* === –†–ï–ñ–ò–ú–´ –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø === */
.mode-cover #youtube-iframe-wrap { opacity: 0; pointer-events: none; }
.mode-cover #cover-image { display: block; }
.mode-audio #visual-container { height: 0; margin-bottom: 0; opacity: 0; }

/* –ò–Ω—Ñ–æ –æ —Ç—Ä–µ–∫–µ */
#current-track-info { font-size: 1.1rem; font-weight: 600; color: var(--primary); min-height: 24px; margin-bottom: 4px; }

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ê–≤—Ç–æ—Ä–∞ –∏ –°—á–µ—Ç—á–∏–∫–∞ (–≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É) */
#meta-info-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 12px;
    flex-wrap: wrap;
    min-height: 24px;
}
#current-channel-info { font-size: 0.9rem; color: #555; }

/* --- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (–ö—Ä—É–≥–ª—ã–µ) --- */
#controls { display: flex; gap: 12px; align-items: center; margin-bottom: 20px; }

.nav-btn {
    display: flex; align-items: center; justify-content: center;
    width: 44px; height: 44px;
    border-radius: 50%; border: none; background: var(--primary); color: #fff;
    cursor: pointer; transition: 0.2s; box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
#playPauseBtn { width: 56px; height: 56px; }

.nav-btn:hover { background: var(--primary-dark); transform: scale(1.05); }

.nav-btn:disabled { 
    background: var(--disabled-color);
    opacity: 0.4;
    box-shadow: none;
    transform: none;
    pointer-events: none; 
}

.nav-btn svg { width: 22px; height: 22px; }
#playPauseBtn svg { width: 28px; height: 28px; }

/* --- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ (3 –∫–Ω–æ–ø–∫–∏) --- */
.mode-switcher {
    display: flex;
    background: #f0f2f5;
    padding: 4px;
    border-radius: 12px;
    gap: 4px;
    width: 100%;
}
.mode-btn {
    flex: 1;
    border: none;
    background: transparent;
    padding: 8px;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 500;
    color: #555;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 6px;
    transition: 0.2s;
}
.mode-btn:hover { background: rgba(0,0,0,0.05); }
.mode-btn.active { background: #fff; color: var(--primary); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
.mode-btn svg { width: 16px; height: 16px; }


/* ================================================= */
/* === –ú–ò–ù–ò-–°–ß–ï–¢–ß–ò–ö (Compact Listener Widget) === */
/* ================================================= */
.listener-widget-compact {
    display: inline-flex;
    align-items: center;
    background: #f0f2f5; 
    padding: 4px 10px;
    border-radius: 12px; 
    gap: 6px;
    color: #444;
    font-size: 0.85rem; 
    vertical-align: middle;
}

.icon-headphones {
    width: 14px;
    height: 14px;
    fill: #777;
}

.live-dot {
    width: 6px;
    height: 6px;
    background-color: #ff3b30;
    border-radius: 50%;
    margin-right: 2px;
    animation: pulse 2s infinite ease-in-out;
}

.counter-wrapper {
    display: flex;
    font-weight: 700;
    line-height: 1; 
    height: 1em;      
    overflow: hidden; 
}

.digit-col {
    position: relative;
    width: 0.65em; 
    text-align: center;
    font-variant-numeric: tabular-nums;
}

.digit-col.spacer { width: 0.25em; }

.digit-track {
    display: flex;
    flex-direction: column;
    will-change: transform;
    transform: translateY(0);
}

.digit-val {
    height: 1em; 
    display: flex;
    align-items: center;
    justify-content: center;
}

@keyframes pulse {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}


/* –ê–¥–∞–ø—Ç–∏–≤ */
@media (max-width: 768px) {
    #player-container { flex-direction: column; }
    #playlist-sidebar { width: 100%; max-height: 200px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    #main-player-area { width: 100%; order: -1; }
    .mode-btn span { display: none; }
}
</style>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-384FKZ1NQP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-384FKZ1NQP');
</script>
</head>
<body>

<div class="wrap">
    <h1>üéß Lofi –ü–ª–µ–µ—Ä</h1>

    <div class="card" id="player-card">
        <div id="player-container">
             
            <div id="playlist-sidebar">
                <h2>–°–ø–∏—Å–æ–∫ —Å—Ç–∞–Ω—Ü–∏–π</h2>
                <div id="playlist-list"></div>
            </div>

            <div id="main-player-area">
                 
                <div id="current-track-info">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                
                <div id="meta-info-row">
                    <div id="current-channel-info"></div>
                    
                    <div class="listener-widget-compact" id="listener-widget" style="display:none;">
                        <div class="live-dot"></div>
                        <div class="counter-wrapper" id="counter-wrapper"></div>
                        <svg class="icon-headphones" viewBox="0 0 24 24">
                            <path d="M12 3a9 9 0 0 0-9 9v7c0 1.1.9 2 2 2h4v-8H5v-1c0-3.87 3.13-7 7-7s7 3.13 7 7v1h-4v8h4c1.1 0 2-.9 2-2v-7a9 9 0 0 0-9-9z"/>
                        </svg>
                    </div>
                </div>

                <div id="visual-container">
                    <div id="youtube-iframe-wrap">
                        <div id="youtube-player-placeholder"></div>
                    </div>
                    <img id="cover-image" src="" alt="Cover">
                </div>

                <div class="mode-switcher">
                    <button class="mode-btn active" onclick="setMode('video')" id="btn-video">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                        <span>–í–∏–¥–µ–æ</span>
                    </button>
                    <button class="mode-btn" onclick="setMode('cover')" id="btn-cover">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                        <span>–ö–∞—Ä—Ç–∏–Ω–∫–∞</span>
                    </button>
                    <button class="mode-btn" onclick="setMode('audio')" id="btn-audio">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                        <span>–ê—É–¥–∏–æ</span>
                    </button>
                </div>

                <div style="margin-bottom: 15px;"></div>

                <div id="controls">
                    <button id="prevBtn" class="nav-btn" onclick="prevVideo()" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    </button>
                      
                    <button id="playPauseBtn" class="nav-btn" onclick="togglePlayPause()">
                        <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                        <svg id="pauseIcon" style="display:none;" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    </button>
                      
                    <button id="nextBtn" class="nav-btn" onclick="nextVideo()" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    const VIDEO_DATA = [
        { id: 'jfKfPfyJRdk', title: 'Lofi Hip Hop Radio üìö', channel: 'Lofi Girl', minList: 16000, maxList: 26000 }, 
        { id: 'h_a3tqywv3I', title: 'Christmas lofi musicüéÑ', channel: 'Lofi Girl', minList: 5000, maxList: 12000 },
        { id: '4xDzrJKXOOY', title: 'Synthwave radio üåå', channel: 'Lofi Girl', minList: 1700, maxList: 2800 },
        { id: 'Na0w3Mz46GA', title: 'Asian lofi radio ‚õ©Ô∏è', channel: 'Lofi Girl', minList: 400, maxList: 1100 },
    ];
      
    let player;
    let currentTrackIndex = 0;
    let currentMode = 'video';
      
    function init() {
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        renderPlaylist();
    }

    function renderPlaylist() {
        const list = document.getElementById('playlist-list');
        list.innerHTML = '';
        VIDEO_DATA.forEach((video, index) => {
            const isActive = index === currentTrackIndex ? ' active' : '';
            const thumb = `https://i.ytimg.com/vi/${video.id}/mqdefault.jpg`;
            list.innerHTML += `
                <div class="playlist-item${isActive}" onclick="loadVideo(${index})">
                    <div class="playlist-thumb"><img src="${thumb}"></div>
                    <div class="playlist-info">
                        <div class="playlist-title">${video.title}</div>
                        <div class="playlist-channel">${video.channel}</div>
                    </div>
                </div>
            `;
        });
        updateButtons();
    }

    function onYouTubeIframeAPIReady() {
        loadVideoCounter(currentTrackIndex);
        player = new YT.Player('youtube-player-placeholder', {
            videoId: VIDEO_DATA[currentTrackIndex].id,
            playerVars: { autoplay: 1, controls: 1, playsinline: 1, rel: 0 },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange,
                'onError': () => nextVideo()
            }
        });
    }

    function onPlayerReady(event) {
        event.target.playVideo();
        updateTrackInfo(); 
    }

    function onPlayerStateChange(event) {
        const isPlaying = event.data === YT.PlayerState.PLAYING;
        document.getElementById('playIcon').style.display = isPlaying ? 'none' : 'block';
        document.getElementById('pauseIcon').style.display = isPlaying ? 'block' : 'none';
        
        if (isPlaying && player.getVideoData) {
            const data = player.getVideoData();
            if (data && data.title) {
                document.getElementById('current-track-info').textContent = data.title;
                document.getElementById('current-channel-info').textContent = data.author; 
                document.title = data.title;
            }
        }
    }

    function loadVideo(index) {
        if (index < 0 || index >= VIDEO_DATA.length) return;
        currentTrackIndex = index;
        
        if(player && player.loadVideoById) {
            player.loadVideoById(VIDEO_DATA[index].id);
        }
        
        const coverUrl = `https://i.ytimg.com/vi/${VIDEO_DATA[index].id}/maxresdefault.jpg`;
        document.getElementById('cover-image').src = coverUrl;

        document.querySelectorAll('.playlist-item').forEach((el, i) => {
            el.classList.toggle('active', i === index);
        });
        updateButtons();
        updateTrackInfo(); 
        
        loadVideoCounter(index);
    }

    function nextVideo() { loadVideo(currentTrackIndex + 1); }
    function prevVideo() { loadVideo(currentTrackIndex - 1); }
      
    function togglePlayPause() {
        if(!player) return;
        const state = player.getPlayerState();
        if (state === YT.PlayerState.PLAYING) player.pauseVideo();
        else player.playVideo();
    }

    function updateButtons() {
        document.getElementById('prevBtn').disabled = currentTrackIndex === 0;
        document.getElementById('nextBtn').disabled = currentTrackIndex === VIDEO_DATA.length - 1;
    }

    function updateTrackInfo() {
        const vid = VIDEO_DATA[currentTrackIndex];
        document.getElementById('current-track-info').textContent = vid.title;
        document.getElementById('current-channel-info').textContent = vid.channel;
        document.getElementById('cover-image').src = `https://i.ytimg.com/vi/${vid.id}/maxresdefault.jpg`;
        document.title = vid.title; 
    }

    function setMode(mode) {
        currentMode = mode;
        const card = document.getElementById('main-player-area');
        
        card.classList.remove('mode-video', 'mode-audio', 'mode-cover');
        card.classList.add('mode-' + mode);

        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn-' + mode).classList.add('active');
    }

    // ==========================================
    // === –õ–û–ì–ò–ö–ê –°–ß–ï–¢–ß–ò–ö–ê ("–ë–∞—Ä–∞–±–∞–Ω" / Odometer) ===
    // ==========================================
    
    const CounterManager = {
        wrapper: document.getElementById('counter-wrapper'),
        currentViewers: 0,
        timer: null,
        cleanupTimer: null,
        config: {},
        currentKey: '',

        stop: function() {
            if (this.timer) clearTimeout(this.timer);
            if (this.cleanupTimer) clearTimeout(this.cleanupTimer);
        },

        init: function(videoId, baseMin, baseMax) {
            this.stop(); 
            document.getElementById('listener-widget').style.display = 'inline-flex';

            this.currentKey = `listeners_v5_drum_${videoId}`; 
            
            this.config = {
                baseMin: baseMin,
                baseMax: baseMax,
                changeMin: 1,
                changeMax: 5, 
                delayMin: 5000,
                delayMax: 20000,
                storageTTL: 180000 
            };

            // 1. –ü–æ–ª—É—á–∞–µ–º —Ü–µ–ª–µ–≤–æ–µ —á–∏—Å–ª–æ
            let targetViewers = 0;
            let restored = false;
            const rawData = localStorage.getItem(this.currentKey);
            const limits = this.getDynamicLimits();

            if (rawData) {
                try {
                    const parsedData = JSON.parse(rawData);
                    const now = Date.now();
                    if (now - parsedData.timestamp < this.config.storageTTL) {
                        targetViewers = parsedData.value;
                        restored = true;
                    } 
                } catch (e) {}
            }

            if (!restored) {
                targetViewers = Math.floor(Math.random() * (limits.max - limits.min + 1)) + limits.min;
            }

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ä–∞–∑—É –∫–∞–∫ —Ü–µ–ª–µ–≤–æ–µ (–≤ –ø–∞–º—è—Ç–∏),
            // –Ω–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –º—ã –±—É–¥–µ–º –∫—Ä—É—Ç–∏—Ç—å –±–∞—Ä–∞–±–∞–Ω
            this.currentViewers = targetViewers;
            this.save();

            // 2. –†–µ–Ω–¥–µ—Ä–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ü–µ–ª–µ–≤–æ–≥–æ —á–∏—Å–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "15 000")
            const finalStr = this.format(targetViewers);
            this.renderStructure(finalStr);

            // 3. –ú–ê–ì–ò–Ø –ë–ê–†–ê–ë–ê–ù–ê (Slot Machine Effect)
            // –ú—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥–º–µ–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞ 0 –∏ –∞–Ω–∏–º–∏—Ä—É–µ–º –∫ —Ü–∏—Ñ—Ä–µ.
            // –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –æ–¥–∏–Ω —Ä–∞–∑, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.
            const cols = this.wrapper.children;
            const stagger = 60; // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏ (–º—Å)

            Array.from(cols).forEach((col, i) => {
                if(col.classList.contains('spacer')) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–±–µ–ª—ã

                const track = col.querySelector('.digit-track');
                const targetDigit = track.querySelector('.digit-val').innerText;

                // –ü–æ–¥–º–µ–Ω—è–µ–º HTML: –í–Ω–∏–∑—É 0, –≤–≤–µ—Ä—Ö—É –¶–µ–ª—å (–º—ã –µ–¥–µ–º —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç)
                // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏: <div>0</div><div>X</div>
                // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è: translate(0) -> –≤–∏–¥–∏–º 0
                // –ö–æ–Ω–µ—á–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: translate(-50%) -> –≤–∏–¥–∏–º X
                track.innerHTML = `<div class="digit-val">0</div><div class="digit-val">${targetDigit}</div>`;
                track.style.transition = 'none';
                track.style.transform = 'translateY(0)'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º 0

                // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –º–∏–≥
                setTimeout(() => {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º cubic-bezier –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ç—è–∂–µ–ª–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
                    track.style.transition = 'transform 1.2s cubic-bezier(0.15, 0.9, 0.3, 1)';
                    track.style.transform = 'translateY(-50%)'; // –ö—Ä—É—Ç–∏–º –∫ —á–∏—Å–ª—É
                }, 50 + (i * stagger));
            });

            // 4. –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã)
            // –ú—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É "–Ω–∞—á–∏—Å—Ç–æ", —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –Ω—É–ª–∏
            // –∏ –≤–µ—Ä–Ω—É—Ç—å —Å–∏—Å—Ç–µ–º—É –≤ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã.
            this.cleanupTimer = setTimeout(() => {
                this.renderStructure(finalStr); // –°–±—Ä–æ—Å DOM –≤ —á–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                this.scheduleNextUpdate(); // –ó–∞–ø—É—Å–∫ –æ–±—ã—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            }, 2000);
        },

        save: function() {
            localStorage.setItem(this.currentKey, JSON.stringify({
                value: this.currentViewers,
                timestamp: Date.now()
            }));
        },

        getDynamicLimits: function() {
            const hour = new Date().getHours(); 
            let coef = 1.0;
            if (hour >= 0 && hour < 6) coef = 0.2;
            else if (hour >= 6 && hour < 12) coef = 0.6;
            else if (hour >= 12 && hour < 18) coef = 0.9;
            else coef = 1.0;

            return {
                min: Math.floor(this.config.baseMin * coef),
                max: Math.floor(this.config.baseMax * coef)
            };
        },

        format: function(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        },

        renderStructure: function(strValue) {
            this.wrapper.innerHTML = '';
            strValue.split('').forEach(char => {
                const col = document.createElement('div');
                col.className = 'digit-col' + (char === ' ' ? ' spacer' : '');
                const track = document.createElement('div');
                track.className = 'digit-track';
                track.innerHTML = `<div class="digit-val">${char}</div>`;
                col.appendChild(track);
                this.wrapper.appendChild(col);
            });
        },

        updateCounter: function() {
            const limits = this.getDynamicLimits();
            let isGrowth;
            
            if (this.currentViewers < limits.min) isGrowth = Math.random() > 0.2; 
            else if (this.currentViewers > limits.max) isGrowth = Math.random() > 0.8; 
            else isGrowth = Math.random() > 0.5;

            const change = Math.floor(Math.random() * (this.config.changeMax - this.config.changeMin + 1)) + this.config.changeMin;
            let nextViewers = isGrowth ? this.currentViewers + change : this.currentViewers - change;

            if (nextViewers < 50) nextViewers = 50;

            if (nextViewers !== this.currentViewers) {
                this.updateDisplay(nextViewers);
                this.currentViewers = nextViewers;
                this.save();
            }
            this.scheduleNextUpdate();
        },

        scheduleNextUpdate: function() {
            const delay = Math.floor(Math.random() * (this.config.delayMax - this.config.delayMin + 1)) + this.config.delayMin;
            this.timer = setTimeout(() => this.updateCounter(), delay);
        },

        updateDisplay: function(newVal) {
            const oldStr = this.format(this.currentViewers);
            const newStr = this.format(newVal);

            if (oldStr.length !== newStr.length) {
                this.renderStructure(newStr);
                return;
            }

            const cols = this.wrapper.children;
            for (let i = 0; i < newStr.length; i++) {
                if (oldStr[i] !== newStr[i]) {
                    this.animateTrack(cols[i].querySelector('.digit-track'), oldStr[i], newStr[i], newVal > this.currentViewers);
                }
            }
        },

        animateTrack: function(track, oldChar, newChar, isUp) {
            // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
            if (isUp) {
                track.innerHTML = `<div class="digit-val">${oldChar}</div><div class="digit-val">${newChar}</div>`;
                track.style.transition = 'none';
                track.style.transform = 'translateY(0)';
            } else {
                track.innerHTML = `<div class="digit-val">${newChar}</div><div class="digit-val">${oldChar}</div>`;
                track.style.transition = 'none';
                track.style.transform = 'translateY(-50%)'; 
            }

            void track.offsetWidth; 

            track.style.transition = 'transform 0.5s cubic-bezier(0.4, 0.0, 0.2, 1)'; 
            track.style.transform = isUp ? 'translateY(-50%)' : 'translateY(0)';

            setTimeout(() => {
                track.style.transition = 'none';
                track.innerHTML = `<div class="digit-val">${newChar}</div>`;
                track.style.transform = 'translateY(0)';
            }, 500);
        }
    };

    function loadVideoCounter(index) {
        const vid = VIDEO_DATA[index];
        const min = vid.minList || 1000;
        const max = vid.maxList || 5000;
        CounterManager.init(vid.id, min, max);
    }

    init();
</script>
    
<link rel="stylesheet" href="footer.css">
<div id="footer"></div>
<script>
fetch('footer.html')
  .then(r => r.text())
  .then(html => document.getElementById('footer').innerHTML = html);
</script>

<link rel="stylesheet" href="auth-widget.css">
<script type="module" src="auth-widget.js"></script>
</body>
</html>
