<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–°–∫–∞—á–∞—Ç—å YouTube –ø—Ä–µ–≤—å—é</title>
 <link rel="icon" type="image/png" href="yt.png">
<style>
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#f6f7fb;color:#0c0c0d}
  .wrap{max-width:800px;margin:0 auto;padding:22px 14px 40px}
  h1{margin:0 0 14px;font-size:1.4rem;text-align:center}
  .card{background:#fff;border:1px solid #e6e9f2;border-radius:12px;padding:16px;box-shadow:0 1px 0 rgba(0,0,0,.03)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center}
  input[type="url"]{flex:1 1 560px;max-width:760px;padding:12px 14px;font-size:1rem;border:1px solid #cfd5e1;border-radius:10px}
  .preview{margin-top:16px;display:flex;justify-content:center}
  .preview a{display:block;width:100%;max-width:860px}
  .preview img{width:100%;height:auto;border-radius:12px;border:1px solid #e6e9f2;background:#eef2ff}

  /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∏–¥–µ–æ */
  .info{margin-top:14px;background:#fbfcff;border:1px solid #e6ecff;border-radius:10px;padding:12px}
  .info .row2{display:grid;gap:6px}
  .k{opacity:.8;min-width:140px;display:inline-block}
  .err{color:#b00020;margin-top:8px}
  .muted{opacity:.7;font-size:.9rem}
</style>
</head>
<body>
<div class="wrap">
  <h1>–°–∫–∞—á–∞—Ç—å YouTube –ø—Ä–µ–≤—å—é</h1>

  <div class="card">
    <div class="row">
      <input id="yturl" type="url" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ..." autocomplete="off">
    </div>

    <!-- –ü—Ä–µ–≤—å—é -->
    <div class="preview" id="out" hidden>
      <a id="thumbLink" target="_blank" rel="noopener">
        <img id="thumb" alt="–ü—Ä–µ–≤—å—é YouTube">
      </a>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∏–¥–µ–æ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–∞) -->
    <div id="videoInfo" class="info" hidden>
      <div class="row2" id="infoRows"></div>
      <div id="apiErr" class="err" hidden></div>
    </div>
  </div>
</div>

<script>
  // üîë –í–°–¢–ê–í–¨–¢–ï –°–í–û–ô API KEY (YouTube Data API v3)
  const API_KEY = "AIzaSyCeQA2-I2pGKQwStB1TN8NQOQcKdgqc7_0";

  const input = document.getElementById('yturl');
  const out   = document.getElementById('out');
  const img   = document.getElementById('thumb');
  const link  = document.getElementById('thumbLink');

  const infoBox   = document.getElementById('videoInfo');
  const infoRows  = document.getElementById('infoRows');
  const apiErrEl  = document.getElementById('apiErr');

 const placeholder = "https://placehold.co/800x450?text=–í—Å—Ç–∞–≤—å—Ç–µ+—Å—Å—ã–ª–∫—É,+—á—Ç–æ–±—ã+—Å–∫–∞—á–∞—Ç—å+–ø—Ä–µ–≤—å—é&font=roboto";
 
 // —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
 img.src = placeholder;
 out.hidden = false;
 link.removeAttribute("href"); // <== —É–±–∏—Ä–∞–µ–º —Å—Å—ã–ª–∫—É, –ø–æ–∫–∞ –≤–∏–¥–µ–æ –Ω–µ—Ç
 link.style.pointerEvents = "none"; // <== –æ—Ç–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏
 link.style.cursor = "default";     // <== –∫—É—Ä—Å–æ—Ä –æ–±—ã—á–Ω—ã–π, –Ω–µ ‚Äú—Ä—É–∫–∞‚Äù

  function parseYouTubeId(url){
    if (!url) return null;
    try{
      const u = new URL(url.trim());
      if (u.hostname.endsWith('youtu.be')) return u.pathname.split('/')[1] || null;
      if (u.searchParams.get('v')) return u.searchParams.get('v');
      if (u.pathname.startsWith('/shorts/')) return u.pathname.split('/')[2] || null;
      if (u.pathname.startsWith('/embed/'))  return u.pathname.split('/')[2] || null;
      return null;
    }catch{ return null; }
  }

  // —Ñ–æ—Ä–º–∞—Ç ¬´10 –æ–∫—Ç—è–±—Ä—è 2025 –≤ 13:00 –ø–æ –º—Å–∫¬ª
  function formatMoscow(dtISO){
    const d = new Date(dtISO);
    const optsDate = { year:'numeric', month:'long', day:'numeric' };
    const optsTime = { hour:'2-digit', minute:'2-digit' };
    const date = d.toLocaleDateString('ru-RU', {...optsDate, timeZone:'Europe/Moscow'});
    const time = d.toLocaleTimeString('ru-RU', {...optsTime, timeZone:'Europe/Moscow'});
    return `${date} –≤ ${time} –ø–æ –º—Å–∫`;
  }

  async function fetchVideoMeta(id){
    if (!API_KEY || API_KEY === 'YOUR_API_KEY_HERE') {
      throw new Error('–ù–µ —É–∫–∞–∑–∞–Ω API –∫–ª—é—á. –í—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π YouTube Data API –∫–ª—é—á –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é API_KEY.');
    }
    const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${id}&key=${API_KEY}`;
    const res = await fetch(url);
    if (!res.ok) {
      const text = await res.text().catch(()=>res.statusText);
      throw new Error(`API error ${res.status}: ${text}`);
    }
    const data = await res.json();
    if (!data.items || !data.items.length) throw new Error('–í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
    const s = data.items[0].snippet || {};
    return {
      title: s.title || '‚Äî',
      channel: s.channelTitle || '‚Äî',
      publishedAt: s.publishedAt || null
    };
  }

  let t; // debounce
 function update(){
  clearTimeout(t);
  t = setTimeout(async ()=>{
    apiErrEl.hidden = true; 
    apiErrEl.textContent = '';
    const id = parseYouTubeId(input.value);

    if (!id){
      // üü° –ù–µ—Ç —Å—Å—ã–ª–∫–∏ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –∏ –æ—Ç–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏
      img.src = placeholder;
      link.removeAttribute("href");
      link.style.pointerEvents = "none";
      link.style.cursor = "default";
      infoBox.hidden = true;
      return;
    }

    // üü¢ –ï—Å—Ç—å ID ‚Üí –≤–∫–ª—é—á–∞–µ–º –ø—Ä–µ–≤—å—é –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–ª–∏–∫–∏
    const max = `https://i.ytimg.com/vi/${id}/maxresdefault.jpg`;
    const hq  = `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;
    img.src = max;
    link.href = max;
    link.style.pointerEvents = "auto";
    link.style.cursor = "pointer";
    img.onerror = () => { 
      img.onerror = null; 
      img.src = hq; 
      link.href = hq; 
    };

    // üîµ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∏–¥–µ–æ
    try {
      const meta = await fetchVideoMeta(id);
      const dateStr = meta.publishedAt ? formatMoscow(meta.publishedAt) : '‚Äî';
      infoRows.innerHTML = `
        <div><span class="k"><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong></span> ${escapeHtml(meta.title)}</div>
        <div><span class="k"><strong>–ö–∞–Ω–∞–ª:</strong></span> ${escapeHtml(meta.channel)}</div>
        <div><span class="k"><strong>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</strong></span> ${dateStr}</div>
      `;
      infoBox.hidden = false;
    } catch(err) {
      infoBox.hidden = false; // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ—Ä–æ–±–∫—É —Å –æ—à–∏–±–∫–æ–π
      infoRows.innerHTML = '';
      apiErrEl.textContent = (err && err.message) ? err.message : String(err);
      apiErrEl.hidden = false;
    }
  }, 250);
}

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  input.addEventListener('input', update);

  // –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ?url=... –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
  (function(){
    const q = new URLSearchParams(location.search).get('url');
    if (q){ input.value = q; update(); }
  })();
</script>
</body>
</html>
